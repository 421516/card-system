<?php
namespace App; use Illuminate\Database\Eloquent\Model; class Order extends Model { protected $guarded = array(); const STATUS_UNPAY = 0; const STATUS_PAID = 1; const STATUS_SUCCESS = 2; const STATUS_FROZEN = 3; const STATUS_REFUND = 4; protected $casts = array('api_info' => 'array'); public static function unique_no() { $sp64a7d9 = date('YmdHis') . str_random(5); while (\App\Order::where('order_no', $sp64a7d9)->exists()) { $sp64a7d9 = date('YmdHis') . str_random(5); } return $sp64a7d9; } function user() { return $this->belongsTo(User::class); } function product() { return $this->belongsTo(Product::class); } function pay() { return $this->belongsTo(Pay::class); } function cards() { $spf6ff0f = $this->belongsToMany(Card::class); return $spf6ff0f->withTrashed(); } function card_orders() { return $this->hasMany(CardOrder::class); } function fundRecord() { return $this->hasMany(FundRecord::class); } }