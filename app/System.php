<?php
namespace App; use Illuminate\Database\Eloquent\Model; use Illuminate\Support\Facades\Cache; use Illuminate\Support\Facades\Log; class System extends Model { protected $guarded = array(); private static $systems = array(); public static function _init() { Log::debug('SystemSetting._init'); static::$systems = Cache::remember('settings.all', 1, function () { Log::debug('SystemSetting._init.fetch from database'); $spf56586 = System::query()->get()->toArray(); foreach ($spf56586 as $sp8558be) { static::$systems[$sp8558be['name']] = $sp8558be['value']; } return static::$systems; }); static::$systems['_initialized'] = true; } public static function _get($spb0d9eb, $spd238b9 = NULL) { if (!isset(static::$systems['_initialized'])) { static::_init(); } if (isset(static::$systems[$spb0d9eb])) { return static::$systems[$spb0d9eb]; } return $spd238b9; } public static function _getInt($spb0d9eb, $spd238b9 = NULL) { return (int) static::_get($spb0d9eb, $spd238b9); } public static function _set($spb0d9eb, $sp67821d) { static::$systems[$spb0d9eb] = $sp67821d; $sp154f6e = System::query()->where('name', $spb0d9eb)->first(); if ($sp154f6e) { $sp154f6e->value = $sp67821d; $sp154f6e->save(); } else { try { System::query()->insert(array('name' => $spb0d9eb, 'value' => $sp67821d)); } catch (\Exception $sp1b3a33) { } } self::flushCache(); } public static function flushCache() { Log::debug('SystemSetting.flushCache'); Cache::forget('settings.all'); } protected static function boot() { parent::boot(); static::updated(function () { self::flushCache(); }); static::created(function () { self::flushCache(); }); } }