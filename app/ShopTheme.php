<?php
namespace App; use Illuminate\Database\Eloquent\Model; class ShopTheme extends Model { protected $guarded = array(); public $timestamps = false; protected $casts = array('config' => 'array'); private static $default_theme; public static function defaultTheme() { if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->where('name', \App\System::_get('shop_theme_default', 'Material'))->first(); if (!static::$default_theme) { static::$default_theme = ShopTheme::query()->firstOrFail(); } } return static::$default_theme; } public static function freshList() { $sp4ef8fc = realpath(app_path('..' . DIRECTORY_SEPARATOR . 'resources' . DIRECTORY_SEPARATOR . 'views' . DIRECTORY_SEPARATOR . 'shop_theme')); \App\ShopTheme::query()->get()->each(function ($sp1f6382) use($sp4ef8fc) { if (!file_exists($sp4ef8fc . DIRECTORY_SEPARATOR . $sp1f6382->name . DIRECTORY_SEPARATOR . 'config.php')) { $sp1f6382->delete(); } }); foreach (scandir($sp4ef8fc) as $sp3f0a78) { if ($sp3f0a78 === '.' || $sp3f0a78 === '..') { continue; } if (!\App\ShopTheme::query()->where('name', $sp3f0a78)->exists()) { try { @($sp1f6382 = (include $sp4ef8fc . DIRECTORY_SEPARATOR . $sp3f0a78 . DIRECTORY_SEPARATOR . 'config.php')); } catch (\Exception $sp1b3a33) { continue; } if ($sp1f6382 && isset($sp1f6382['description'])) { \App\ShopTheme::query()->insert(array('name' => $sp3f0a78, 'description' => $sp1f6382['description'], 'config' => json_encode(@$sp1f6382['config']))); } } } } }