<?php
namespace App\Http\Controllers; use App\System; use Illuminate\Foundation\Bus\DispatchesJobs; use Illuminate\Routing\Controller as BaseController; use Illuminate\Foundation\Validation\ValidatesRequests; use Illuminate\Foundation\Auth\Access\AuthorizesRequests; use Illuminate\Http\Request; class Controller extends BaseController { use AuthorizesRequests, DispatchesJobs, ValidatesRequests; function is_mobile() { if (isset($_SERVER['HTTP_USER_AGENT'])) { if (preg_match('/(iPhone|iPod|Android|ios|SymbianOS|Windows Phone)/i', $_SERVER['HTTP_USER_AGENT'])) { return true; } } return false; } protected function isAdmin() { return \Auth::getUser()->role === 'admin'; } function authQuery(Request $sp2d83a6, $sp3caac9, $sp9096e0 = 'user_id', $sp5c764e = 'user_id') { if (self::isAdmin()) { $spc52aea = (int) $sp2d83a6->input($sp5c764e); if ($spc52aea) { return $sp3caac9::where($sp9096e0, $spc52aea); } return $sp3caac9::query(); } else { return $sp3caac9::where($sp9096e0, \Auth::id()); } } protected function getUserId(Request $sp2d83a6, $sp5c764e = 'user_id') { return \Auth::id(); } protected function getUserIdOrFail(Request $sp2d83a6, $sp5c764e = 'user_id') { $spc52aea = self::getUserId($sp2d83a6, $sp5c764e); if ($spc52aea) { return $spc52aea; } else { throw new \Exception('参数缺少 ' . $sp5c764e); } } protected function getUser(Request $sp2d83a6) { if (self::isAdmin()) { $spc52aea = (int) $sp2d83a6->post('user_id'); if (!$spc52aea) { return null; } $spc6e0c5 = \App\User::findOrFail($spc52aea); return $spc6e0c5; } else { return \Auth::getUser(); } } protected function checkIsInMaintain() { if ((int) System::_get('maintain') === 1) { $spedc00b = System::_get('maintain_info'); echo view('message', array('title' => '维护中', 'message' => $spedc00b)); die; } } protected function msg($spcef806, $spd86fc4 = null, $sp7b5ade = null) { return view('message', array('message' => $spcef806, 'title' => $spd86fc4, 'exception' => $sp7b5ade)); } }