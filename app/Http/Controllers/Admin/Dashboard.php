<?php
namespace App\Http\Controllers\Admin; use App\Library\Response; use App\Order; use Illuminate\Http\Request; use App\Http\Controllers\Controller; class Dashboard extends Controller { function index(Request $sp85ba11) { $sp3c2dbb = array('today' => array('count' => 0, 'paid' => 0, 'profit' => 0), 'yesterday' => array('count' => 0, 'paid' => 0, 'profit' => 0)); $sp11a90f = Order::whereUserId(\Auth::Id())->whereDate('paid_at', \Carbon\Carbon::now()->toDateString())->where(function ($spfed6d4) { $spfed6d4->where('status', Order::STATUS_PAID)->orWhere('status', Order::STATUS_SUCCESS); })->selectRaw('COUNT(*) as `count`,SUM(`paid`) as `paid`,SUM(`paid`-`cost`-`fee`) as `profit`')->get()->toArray(); $sp64457b = Order::whereUserId(\Auth::Id())->whereDate('paid_at', \Carbon\Carbon::yesterday()->toDateString())->where(function ($spfed6d4) { $spfed6d4->where('status', Order::STATUS_PAID)->orWhere('status', Order::STATUS_SUCCESS); })->selectRaw('COUNT(*) as `count`,SUM(`paid`) as `paid`,SUM(`paid`-`cost`-`fee`) as `profit`')->get()->toArray(); if (isset($sp11a90f[0]) && isset($sp11a90f[0]['count'])) { $sp3c2dbb['today'] = array('count' => (int) $sp11a90f[0]['count'], 'paid' => (int) $sp11a90f[0]['paid'], 'profit' => (int) $sp11a90f[0]['profit']); } if (isset($sp64457b[0]) && isset($sp64457b[0]['count'])) { $sp3c2dbb['yesterday'] = array('count' => (int) $sp64457b[0]['count'], 'paid' => (int) $sp64457b[0]['paid'], 'profit' => (int) $sp64457b[0]['profit']); } $sp3c2dbb['need_ship_count'] = Order::whereUserId(\Auth::Id())->where('status', Order::STATUS_PAID)->count(); $sp3c2dbb['login'] = \App\Log::where('action', \App\Log::ACTION_LOGIN)->latest()->firstOrFail(); return Response::success($sp3c2dbb); } function clearCache() { if (function_exists('opcache_reset')) { opcache_reset(); } try { \Artisan::call('cache:clear'); \Artisan::call('route:cache'); \Artisan::call('config:cache'); } catch (\Throwable $sp1b3a33) { return Response::fail($sp1b3a33->getMessage()); } return Response::success(); } }