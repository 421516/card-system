<?php
namespace App\Http\Controllers\Admin; use App\Library\Helper; use function foo\func; use Illuminate\Http\Request; use App\Http\Controllers\Controller; use App\Library\Response; class Pay extends Controller { function get(Request $spdd9f33) { $sp26c3c2 = \App\Pay::orderBy('sort'); $spc08eb6 = $spdd9f33->post('enabled'); if (strlen($spc08eb6)) { $sp26c3c2->whereIn('enabled', explode(',', $spc08eb6)); } $sp282adb = $spdd9f33->post('search', false); if ($sp282adb == 'simple') { return Response::success($sp26c3c2->get(array('id', 'name'))); } $spec1114 = $sp26c3c2->get(); return Response::success($spec1114); } function stat(Request $spdd9f33) { $sp96acf1 = (int) $spdd9f33->input('day', 7); $spec1114 = \App\Order::where(function ($sp26c3c2) { $sp26c3c2->where('status', \App\Order::STATUS_PAID)->orWhere('status', \App\Order::STATUS_SUCCESS); })->where('paid_at', '>=', Helper::getMysqlDate(-$sp96acf1 + 1))->with(array('pay' => function ($sp26c3c2) { $sp26c3c2->select(array('id', 'name')); }))->groupBy('pay_id')->selectRaw('`pay_id`,COUNT(*) as "count",SUM(`paid`) as "sum"')->get()->toArray(); $sp123706 = array(); foreach ($spec1114 as $spa41ce4) { if (isset($spa41ce4['pay']) && isset($spa41ce4['pay']['name'])) { $spdc76e0 = $spa41ce4['pay']['name']; } else { $spdc76e0 = '未知方式#' . $spa41ce4['pay_id']; } $sp123706[$spdc76e0] = array((int) $spa41ce4['count'], (int) $spa41ce4['sum']); } return Response::success($sp123706); } function edit(Request $spdd9f33) { $this->validate($spdd9f33, array('id' => 'required|integer', 'name' => 'required|string', 'img' => 'required|string', 'driver' => 'required|string', 'way' => 'required|string', 'config' => 'required|string')); $sp403bd7 = (int) $spdd9f33->post('id'); $spa8020b = $spdd9f33->post('name'); $sp6f24cc = $spdd9f33->post('img'); $sp175392 = $spdd9f33->post('comment'); $sp3f9daa = $spdd9f33->post('driver'); $sp04ee60 = $spdd9f33->post('way'); $sp4d5cc2 = $spdd9f33->post('config'); $spc08eb6 = (int) $spdd9f33->post('enabled'); $sp80d3a4 = \App\Pay::find($sp403bd7); if (!$sp80d3a4) { $sp80d3a4 = new \App\Pay(); } $sp80d3a4->name = $spa8020b; $sp80d3a4->img = $sp6f24cc; $sp80d3a4->comment = $sp175392; $sp80d3a4->driver = $sp3f9daa; $sp80d3a4->way = $sp04ee60; $sp80d3a4->config = $sp4d5cc2; $sp80d3a4->enabled = $spc08eb6; $sp80d3a4->fee_system = $spdd9f33->post('fee_system'); $sp80d3a4->saveOrFail(); return Response::success(); } function comment(Request $spdd9f33) { $sp403bd7 = (int) $spdd9f33->post('id', -1); if (!$sp403bd7) { return Response::forbidden(); } $sp80d3a4 = \App\Pay::findOrFail($sp403bd7); $sp80d3a4->comment = $spdd9f33->post('comment'); $sp80d3a4->save(); return Response::success(); } function sort(Request $spdd9f33) { $sp403bd7 = (int) $spdd9f33->post('id', -1); if (!$sp403bd7) { return Response::forbidden(); } $sp80d3a4 = \App\Pay::findOrFail($sp403bd7); $sp80d3a4->sort = (int) $spdd9f33->post('sort', 1000); $sp80d3a4->save(); return Response::success(); } function fee_system(Request $spdd9f33) { $sp403bd7 = (int) $spdd9f33->post('id'); if ($sp403bd7 < 1) { return Response::forbidden(); } $sp80d3a4 = \App\Pay::findOrFail($sp403bd7); $sp80d3a4->fee_system = $spdd9f33->post('fee_system'); $sp80d3a4->saveOrFail(); return Response::success(); } function enable(Request $spdd9f33) { $sp12219c = $spdd9f33->post('ids'); if (strlen($sp12219c) < 1) { return Response::forbidden(); } $spc08eb6 = (int) $spdd9f33->post('enabled'); \App\Pay::whereIn('id', explode(',', $sp12219c))->update(array('enabled' => $spc08eb6)); return Response::success(); } function delete(Request $spdd9f33) { $sp403bd7 = (int) $spdd9f33->post('id'); if ($sp403bd7 < 1) { return Response::forbidden(); } \App\Pay::whereId($sp403bd7)->delete(); return Response::success(); } }