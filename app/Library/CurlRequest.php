<?php
namespace App\Library; class CurlRequest { private static function curl($sp11a0e0, $sp090f2c = 0, $spf7cec4 = '', &$spfe6fd1 = '', $sp77ba0d = array(), $sp9532e1 = 5) { if (!isset($sp77ba0d['Accept'])) { $sp77ba0d['Accept'] = '*/*'; } if (!isset($sp77ba0d['Referer'])) { $sp77ba0d['Referer'] = $sp11a0e0; } if (!isset($sp77ba0d['Content-Type'])) { $sp77ba0d['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp77ba0d['User-Agent'])) { $sp77ba0d['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($spfe6fd1 != '') { $sp77ba0d['Cookie'] = $spfe6fd1; } $sp2a6e46 = array(); foreach ($sp77ba0d as $sp9f0fbb => $sp9f6c87) { $sp2a6e46[] = $sp9f0fbb . ': ' . $sp9f6c87; } $sp2a6e46[] = 'Expect:'; $sp082589 = curl_init(); curl_setopt($sp082589, CURLOPT_URL, $sp11a0e0); if ($sp090f2c == 1) { curl_setopt($sp082589, CURLOPT_POST, 1); if ($spf7cec4 != '') { curl_setopt($sp082589, CURLOPT_POSTFIELDS, $spf7cec4); } } if (defined('MY_PROXY')) { curl_setopt($sp082589, CURLOPT_PROXY, MY_PROXY); } if (defined('MY_PROXY_PASS')) { curl_setopt($sp082589, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } curl_setopt($sp082589, CURLOPT_TIMEOUT, $sp9532e1); curl_setopt($sp082589, CURLOPT_CONNECTTIMEOUT, $sp9532e1); curl_setopt($sp082589, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp082589, CURLOPT_HEADER, 1); curl_setopt($sp082589, CURLOPT_HTTPHEADER, $sp2a6e46); $sp0e2174 = curl_exec($sp082589); $sp71924e = curl_getinfo($sp082589, CURLINFO_HEADER_SIZE); $sp08e8a9 = substr($sp0e2174, 0, $sp71924e); $sp92f0c1 = substr($sp0e2174, $sp71924e); curl_close($sp082589); $sp77ba0d = explode('
', $sp08e8a9); $spe71a5b = ''; foreach ($sp77ba0d as $sp08e8a9) { if (strpos($sp08e8a9, 'Set-Cookie') !== false) { if (strpos($sp08e8a9, ';') !== false) { $spe71a5b = $spe71a5b . trim(Helper::str_between($sp08e8a9, 'Set-Cookie:', ';')) . ';'; } else { $spe71a5b = $spe71a5b . trim(str_replace('Set-Cookie:', '', $sp08e8a9)) . ';'; } } } $spfe6fd1 = self::combineCookie($spfe6fd1, $spe71a5b); return $sp92f0c1; } public static function get($sp11a0e0, &$spfe6fd1 = '', $sp77ba0d = array(), $sp9532e1 = 5) { return self::curl($sp11a0e0, 0, '', $spfe6fd1, $sp77ba0d, $sp9532e1); } public static function post($sp11a0e0, $spf7cec4 = '', &$spfe6fd1 = '', $sp77ba0d = array(), $sp9532e1 = 5) { return self::curl($sp11a0e0, 1, $spf7cec4, $spfe6fd1, $sp77ba0d, $sp9532e1); } public static function combineCookie($sp83c94b, $sp91fb29) { $sp4b65a3 = explode(';', $sp83c94b); $sp5765be = explode(';', $sp91fb29); foreach ($sp4b65a3 as $sp8b5901) { if (self::cookieIsExists($sp5765be, self::cookieGetName($sp8b5901)) == false) { array_push($sp5765be, $sp8b5901); } } $sp15f878 = ''; foreach ($sp5765be as $sp8b5901) { if (substr($sp8b5901, -8, 8) != '=deleted' && strlen($sp8b5901) > 1) { $sp15f878 .= $sp8b5901 . '; '; } } return substr($sp15f878, 0, strlen($sp15f878) - 2); } public static function cookieGetName($sp4008fb) { $sp58db12 = strpos($sp4008fb, '='); return substr($sp4008fb, 0, $sp58db12); } public static function cookieGetValue($sp4008fb) { $sp58db12 = strpos($sp4008fb, '='); $spd38ff6 = substr($sp4008fb, $sp58db12 + 1, strlen($sp4008fb) - $sp58db12); return $spd38ff6; } public static function cookieGet($spfe6fd1, $spb0d9eb, $sp28503f = false) { $spfe6fd1 = str_replace(' ', '', $spfe6fd1); if (substr($spfe6fd1, -1, 1) != ';') { $spfe6fd1 = ';' . $spfe6fd1 . ';'; } else { $spfe6fd1 = ';' . $spfe6fd1; } $sp667608 = Helper::str_between($spfe6fd1, ';' . $spb0d9eb . '=', ';'); if (!$sp28503f || $sp667608 == '') { return $sp667608; } else { return $spb0d9eb . '=' . $sp667608; } } private static function cookieIsExists($sp31e9f5, $sp24b672) { foreach ($sp31e9f5 as $sp8b5901) { if (self::cookieGetName($sp8b5901) == $sp24b672) { return true; } } return false; } function test() { $spd38ff6 = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($spd38ff6); } }