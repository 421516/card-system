<?php
namespace App\Library; class CurlRequest { private static function curl($sp7a0d0d, $sp1ebc2f = 0, $sp1bb3d0 = '', &$spde6bcb = '', $sp21afdb = array(), $spb1eeef = 5) { if (!isset($sp21afdb['Accept'])) { $sp21afdb['Accept'] = '*/*'; } if (!isset($sp21afdb['Referer'])) { $sp21afdb['Referer'] = $sp7a0d0d; } if (!isset($sp21afdb['Content-Type'])) { $sp21afdb['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp21afdb['User-Agent'])) { $sp21afdb['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($spde6bcb != '') { $sp21afdb['Cookie'] = $spde6bcb; } $sp598b48 = array(); foreach ($sp21afdb as $sp7d9317 => $sp1f02dc) { $sp598b48[] = $sp7d9317 . ': ' . $sp1f02dc; } $sp598b48[] = 'Expect:'; $spb70507 = curl_init(); curl_setopt($spb70507, CURLOPT_URL, $sp7a0d0d); if ($sp1ebc2f == 1) { curl_setopt($spb70507, CURLOPT_POST, 1); if ($sp1bb3d0 != '') { curl_setopt($spb70507, CURLOPT_POSTFIELDS, $sp1bb3d0); } } if (defined('MY_PROXY')) { curl_setopt($spb70507, CURLOPT_PROXY, MY_PROXY); } if (defined('MY_PROXY_PASS')) { curl_setopt($spb70507, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } curl_setopt($spb70507, CURLOPT_TIMEOUT, $spb1eeef); curl_setopt($spb70507, CURLOPT_CONNECTTIMEOUT, $spb1eeef); curl_setopt($spb70507, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spb70507, CURLOPT_HEADER, 1); curl_setopt($spb70507, CURLOPT_HTTPHEADER, $sp598b48); $sp73b7ae = curl_exec($spb70507); $sp45daba = curl_getinfo($spb70507, CURLINFO_HEADER_SIZE); $sp6e5e49 = substr($sp73b7ae, 0, $sp45daba); $sp33eb4d = substr($sp73b7ae, $sp45daba); curl_close($spb70507); $sp21afdb = explode('
', $sp6e5e49); $sp397799 = ''; foreach ($sp21afdb as $sp6e5e49) { if (strpos($sp6e5e49, 'Set-Cookie') !== false) { if (strpos($sp6e5e49, ';') !== false) { $sp397799 = $sp397799 . trim(Helper::strBetween($sp6e5e49, 'Set-Cookie:', ';')) . ';'; } else { $sp397799 = $sp397799 . trim(str_replace('Set-Cookie:', '', $sp6e5e49)) . ';'; } } } $spde6bcb = self::combineCookie($spde6bcb, $sp397799); return $sp33eb4d; } public static function get($sp7a0d0d, &$spde6bcb = '', $sp21afdb = array(), $spb1eeef = 5) { return self::curl($sp7a0d0d, 0, '', $spde6bcb, $sp21afdb, $spb1eeef); } public static function post($sp7a0d0d, $sp1bb3d0 = '', &$spde6bcb = '', $sp21afdb = array(), $spb1eeef = 5) { return self::curl($sp7a0d0d, 1, $sp1bb3d0, $spde6bcb, $sp21afdb, $spb1eeef); } public static function combineCookie($spad2c60, $sp63c731) { $spfacbf6 = explode(';', $spad2c60); $sp1da6af = explode(';', $sp63c731); foreach ($spfacbf6 as $spa3d810) { if (self::cookieIsExists($sp1da6af, self::cookieGetName($spa3d810)) == false) { array_push($sp1da6af, $spa3d810); } } $sp1d1402 = ''; foreach ($sp1da6af as $spa3d810) { if (substr($spa3d810, -8, 8) != '=deleted' && strlen($spa3d810) > 1) { $sp1d1402 .= $spa3d810 . '; '; } } return substr($sp1d1402, 0, strlen($sp1d1402) - 2); } public static function cookieGetName($sp96c0a9) { $sp41a1aa = strpos($sp96c0a9, '='); return substr($sp96c0a9, 0, $sp41a1aa); } public static function cookieGetValue($sp96c0a9) { $sp41a1aa = strpos($sp96c0a9, '='); $sp380c6e = substr($sp96c0a9, $sp41a1aa + 1, strlen($sp96c0a9) - $sp41a1aa); return $sp380c6e; } public static function cookieGet($spde6bcb, $spe51eb0, $sp20f5bc = false) { $spde6bcb = str_replace(' ', '', $spde6bcb); if (substr($spde6bcb, -1, 1) != ';') { $spde6bcb = ';' . $spde6bcb . ';'; } else { $spde6bcb = ';' . $spde6bcb; } $sp5548ba = Helper::strBetween($spde6bcb, ';' . $spe51eb0 . '=', ';'); if (!$sp20f5bc || $sp5548ba == '') { return $sp5548ba; } else { return $spe51eb0 . '=' . $sp5548ba; } } private static function cookieIsExists($sp8530be, $sp748f6f) { foreach ($sp8530be as $spa3d810) { if (self::cookieGetName($spa3d810) == $sp748f6f) { return true; } } return false; } function test() { $sp380c6e = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($sp380c6e); } }