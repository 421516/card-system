<?php
namespace App\Library; class CurlRequest { private static function curl($sp78f833, $spf9cb1e = 0, $spbdf5cf = '', &$sp2aa970 = '', $sp8298e9 = array(), $spa1cdba = 5) { if (!isset($sp8298e9['Accept'])) { $sp8298e9['Accept'] = '*/*'; } if (!isset($sp8298e9['Referer'])) { $sp8298e9['Referer'] = $sp78f833; } if (!isset($sp8298e9['Content-Type'])) { $sp8298e9['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp8298e9['User-Agent'])) { $sp8298e9['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($sp2aa970 != '') { $sp8298e9['Cookie'] = $sp2aa970; } $spcf0a3d = array(); foreach ($sp8298e9 as $spee6a3d => $sp9891f7) { $spcf0a3d[] = $spee6a3d . ': ' . $sp9891f7; } $spcf0a3d[] = 'Expect:'; $sp7a336f = curl_init(); curl_setopt($sp7a336f, CURLOPT_URL, $sp78f833); if ($spf9cb1e == 1) { curl_setopt($sp7a336f, CURLOPT_POST, 1); if ($spbdf5cf != '') { curl_setopt($sp7a336f, CURLOPT_POSTFIELDS, $spbdf5cf); } } if (defined('MY_PROXY')) { curl_setopt($sp7a336f, CURLOPT_PROXY, MY_PROXY); } if (defined('MY_PROXY_PASS')) { curl_setopt($sp7a336f, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } curl_setopt($sp7a336f, CURLOPT_TIMEOUT, $spa1cdba); curl_setopt($sp7a336f, CURLOPT_CONNECTTIMEOUT, $spa1cdba); curl_setopt($sp7a336f, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp7a336f, CURLOPT_HEADER, 1); curl_setopt($sp7a336f, CURLOPT_HTTPHEADER, $spcf0a3d); $sp1de750 = curl_exec($sp7a336f); $sp253eb1 = curl_getinfo($sp7a336f, CURLINFO_HEADER_SIZE); $sp74b5a4 = substr($sp1de750, 0, $sp253eb1); $sp5b5e88 = substr($sp1de750, $sp253eb1); curl_close($sp7a336f); $sp8298e9 = explode('
', $sp74b5a4); $spd3dac8 = ''; foreach ($sp8298e9 as $sp74b5a4) { if (strpos($sp74b5a4, 'Set-Cookie') !== false) { if (strpos($sp74b5a4, ';') !== false) { $spd3dac8 = $spd3dac8 . trim(Helper::strBetween($sp74b5a4, 'Set-Cookie:', ';')) . ';'; } else { $spd3dac8 = $spd3dac8 . trim(str_replace('Set-Cookie:', '', $sp74b5a4)) . ';'; } } } $sp2aa970 = self::combineCookie($sp2aa970, $spd3dac8); return $sp5b5e88; } public static function get($sp78f833, &$sp2aa970 = '', $sp8298e9 = array(), $spa1cdba = 5) { return self::curl($sp78f833, 0, '', $sp2aa970, $sp8298e9, $spa1cdba); } public static function post($sp78f833, $spbdf5cf = '', &$sp2aa970 = '', $sp8298e9 = array(), $spa1cdba = 5) { return self::curl($sp78f833, 1, $spbdf5cf, $sp2aa970, $sp8298e9, $spa1cdba); } public static function combineCookie($spbc73ae, $spb4e46c) { $sp3bc21d = explode(';', $spbc73ae); $spf76304 = explode(';', $spb4e46c); foreach ($sp3bc21d as $spcb1023) { if (self::cookieIsExists($spf76304, self::cookieGetName($spcb1023)) == false) { array_push($spf76304, $spcb1023); } } $speb1ba5 = ''; foreach ($spf76304 as $spcb1023) { if (substr($spcb1023, -8, 8) != '=deleted' && strlen($spcb1023) > 1) { $speb1ba5 .= $spcb1023 . '; '; } } return substr($speb1ba5, 0, strlen($speb1ba5) - 2); } public static function cookieGetName($spc9b9d3) { $spdc76e0 = strpos($spc9b9d3, '='); return substr($spc9b9d3, 0, $spdc76e0); } public static function cookieGetValue($spc9b9d3) { $spdc76e0 = strpos($spc9b9d3, '='); $sp36f572 = substr($spc9b9d3, $spdc76e0 + 1, strlen($spc9b9d3) - $spdc76e0); return $sp36f572; } public static function cookieGet($sp2aa970, $spa8020b, $sp52fd3b = false) { $sp2aa970 = str_replace(' ', '', $sp2aa970); if (substr($sp2aa970, -1, 1) != ';') { $sp2aa970 = ';' . $sp2aa970 . ';'; } else { $sp2aa970 = ';' . $sp2aa970; } $spd9e979 = Helper::strBetween($sp2aa970, ';' . $spa8020b . '=', ';'); if (!$sp52fd3b || $spd9e979 == '') { return $spd9e979; } else { return $spa8020b . '=' . $spd9e979; } } private static function cookieIsExists($spd412a8, $sp7df4f7) { foreach ($spd412a8 as $spcb1023) { if (self::cookieGetName($spcb1023) == $sp7df4f7) { return true; } } return false; } function test() { $sp36f572 = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($sp36f572); } }