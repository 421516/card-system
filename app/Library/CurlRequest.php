<?php
namespace App\Library; class CurlRequest { private static function curl($sp833b34, $spc24a77 = 0, $spe84b71 = '', &$spe5db61 = '', $sp955824 = array(), $sp1ca900 = 5) { if (!isset($sp955824['Accept'])) { $sp955824['Accept'] = '*/*'; } if (!isset($sp955824['Referer'])) { $sp955824['Referer'] = $sp833b34; } if (!isset($sp955824['Content-Type'])) { $sp955824['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp955824['User-Agent'])) { $sp955824['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($spe5db61 != '') { $sp955824['Cookie'] = $spe5db61; } $sp2ed228 = array(); foreach ($sp955824 as $sp6b440d => $sp8a269c) { $sp2ed228[] = $sp6b440d . ': ' . $sp8a269c; } $sp2ed228[] = 'Expect:'; $speafaa9 = curl_init(); curl_setopt($speafaa9, CURLOPT_URL, $sp833b34); if ($spc24a77 == 1) { curl_setopt($speafaa9, CURLOPT_POST, 1); if ($spe84b71 != '') { curl_setopt($speafaa9, CURLOPT_POSTFIELDS, $spe84b71); } } if (defined('MY_PROXY')) { curl_setopt($speafaa9, CURLOPT_PROXY, MY_PROXY); } if (defined('MY_PROXY_PASS')) { curl_setopt($speafaa9, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } curl_setopt($speafaa9, CURLOPT_TIMEOUT, $sp1ca900); curl_setopt($speafaa9, CURLOPT_CONNECTTIMEOUT, $sp1ca900); curl_setopt($speafaa9, CURLOPT_RETURNTRANSFER, 1); curl_setopt($speafaa9, CURLOPT_HEADER, 1); curl_setopt($speafaa9, CURLOPT_HTTPHEADER, $sp2ed228); $spfd13d8 = curl_exec($speafaa9); $sp892c98 = curl_getinfo($speafaa9, CURLINFO_HEADER_SIZE); $spf15143 = substr($spfd13d8, 0, $sp892c98); $sp1d246b = substr($spfd13d8, $sp892c98); curl_close($speafaa9); $sp955824 = explode('
', $spf15143); $spf4413c = ''; foreach ($sp955824 as $spf15143) { if (strpos($spf15143, 'Set-Cookie') !== false) { if (strpos($spf15143, ';') !== false) { $spf4413c = $spf4413c . trim(Helper::strBetween($spf15143, 'Set-Cookie:', ';')) . ';'; } else { $spf4413c = $spf4413c . trim(str_replace('Set-Cookie:', '', $spf15143)) . ';'; } } } $spe5db61 = self::combineCookie($spe5db61, $spf4413c); return $sp1d246b; } public static function get($sp833b34, &$spe5db61 = '', $sp955824 = array(), $sp1ca900 = 5) { return self::curl($sp833b34, 0, '', $spe5db61, $sp955824, $sp1ca900); } public static function post($sp833b34, $spe84b71 = '', &$spe5db61 = '', $sp955824 = array(), $sp1ca900 = 5) { return self::curl($sp833b34, 1, $spe84b71, $spe5db61, $sp955824, $sp1ca900); } public static function combineCookie($sp26c691, $sp7779c3) { $spe76aac = explode(';', $sp26c691); $sp12298e = explode(';', $sp7779c3); foreach ($spe76aac as $sp4a1a5b) { if (self::cookieIsExists($sp12298e, self::cookieGetName($sp4a1a5b)) == false) { array_push($sp12298e, $sp4a1a5b); } } $spd204ae = ''; foreach ($sp12298e as $sp4a1a5b) { if (substr($sp4a1a5b, -8, 8) != '=deleted' && strlen($sp4a1a5b) > 1) { $spd204ae .= $sp4a1a5b . '; '; } } return substr($spd204ae, 0, strlen($spd204ae) - 2); } public static function cookieGetName($spfe5c06) { $sp307ccc = strpos($spfe5c06, '='); return substr($spfe5c06, 0, $sp307ccc); } public static function cookieGetValue($spfe5c06) { $sp307ccc = strpos($spfe5c06, '='); $sp191fe2 = substr($spfe5c06, $sp307ccc + 1, strlen($spfe5c06) - $sp307ccc); return $sp191fe2; } public static function cookieGet($spe5db61, $sp074e36, $sp61129a = false) { $spe5db61 = str_replace(' ', '', $spe5db61); if (substr($spe5db61, -1, 1) != ';') { $spe5db61 = ';' . $spe5db61 . ';'; } else { $spe5db61 = ';' . $spe5db61; } $sp43f309 = Helper::strBetween($spe5db61, ';' . $sp074e36 . '=', ';'); if (!$sp61129a || $sp43f309 == '') { return $sp43f309; } else { return $sp074e36 . '=' . $sp43f309; } } private static function cookieIsExists($sp38f85b, $sp779560) { foreach ($sp38f85b as $sp4a1a5b) { if (self::cookieGetName($sp4a1a5b) == $sp779560) { return true; } } return false; } function test() { $sp191fe2 = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($sp191fe2); } }