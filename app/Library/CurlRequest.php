<?php
namespace App\Library; class CurlRequest { private static function curl($spdfc1ea, $sp4a290e = 0, $sp884794 = '', &$spe5644b = '', $spdbbeeb = array(), $sp544006 = 5) { if (!isset($spdbbeeb['Accept'])) { $spdbbeeb['Accept'] = '*/*'; } if (!isset($spdbbeeb['Referer'])) { $spdbbeeb['Referer'] = $spdfc1ea; } if (!isset($spdbbeeb['Content-Type'])) { $spdbbeeb['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($spdbbeeb['User-Agent'])) { $spdbbeeb['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($spe5644b != '') { $spdbbeeb['Cookie'] = $spe5644b; } $sp9633df = array(); foreach ($spdbbeeb as $spc86439 => $spbd8a0c) { $sp9633df[] = $spc86439 . ': ' . $spbd8a0c; } $sp9633df[] = 'Expect:'; $spde874d = curl_init(); curl_setopt($spde874d, CURLOPT_URL, $spdfc1ea); if ($sp4a290e == 1) { curl_setopt($spde874d, CURLOPT_POST, 1); if ($sp884794 != '') { curl_setopt($spde874d, CURLOPT_POSTFIELDS, $sp884794); } } if (defined('MY_PROXY')) { curl_setopt($spde874d, CURLOPT_PROXY, MY_PROXY); } if (defined('MY_PROXY_PASS')) { curl_setopt($spde874d, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } curl_setopt($spde874d, CURLOPT_TIMEOUT, $sp544006); curl_setopt($spde874d, CURLOPT_CONNECTTIMEOUT, $sp544006); curl_setopt($spde874d, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spde874d, CURLOPT_HEADER, 1); curl_setopt($spde874d, CURLOPT_HTTPHEADER, $sp9633df); $sp5241d0 = curl_exec($spde874d); $sp7b7575 = curl_getinfo($spde874d, CURLINFO_HEADER_SIZE); $sp59c615 = substr($sp5241d0, 0, $sp7b7575); $speb838e = substr($sp5241d0, $sp7b7575); curl_close($spde874d); $spdbbeeb = explode('
', $sp59c615); $sp607907 = ''; foreach ($spdbbeeb as $sp59c615) { if (strpos($sp59c615, 'Set-Cookie') !== false) { if (strpos($sp59c615, ';') !== false) { $sp607907 = $sp607907 . trim(Helper::strBetween($sp59c615, 'Set-Cookie:', ';')) . ';'; } else { $sp607907 = $sp607907 . trim(str_replace('Set-Cookie:', '', $sp59c615)) . ';'; } } } $spe5644b = self::combineCookie($spe5644b, $sp607907); return $speb838e; } public static function get($spdfc1ea, &$spe5644b = '', $spdbbeeb = array(), $sp544006 = 5) { return self::curl($spdfc1ea, 0, '', $spe5644b, $spdbbeeb, $sp544006); } public static function post($spdfc1ea, $sp884794 = '', &$spe5644b = '', $spdbbeeb = array(), $sp544006 = 5) { return self::curl($spdfc1ea, 1, $sp884794, $spe5644b, $spdbbeeb, $sp544006); } public static function combineCookie($specea8e, $sp2b29ad) { $sp06434a = explode(';', $specea8e); $spc5f91d = explode(';', $sp2b29ad); foreach ($sp06434a as $sp9ee6fd) { if (self::cookieIsExists($spc5f91d, self::cookieGetName($sp9ee6fd)) == false) { array_push($spc5f91d, $sp9ee6fd); } } $spf1c596 = ''; foreach ($spc5f91d as $sp9ee6fd) { if (substr($sp9ee6fd, -8, 8) != '=deleted' && strlen($sp9ee6fd) > 1) { $spf1c596 .= $sp9ee6fd . '; '; } } return substr($spf1c596, 0, strlen($spf1c596) - 2); } public static function cookieGetName($sp4a6da8) { $spbe447c = strpos($sp4a6da8, '='); return substr($sp4a6da8, 0, $spbe447c); } public static function cookieGetValue($sp4a6da8) { $spbe447c = strpos($sp4a6da8, '='); $sp1c0919 = substr($sp4a6da8, $spbe447c + 1, strlen($sp4a6da8) - $spbe447c); return $sp1c0919; } public static function cookieGet($spe5644b, $spb44bf2, $sp56f92d = false) { $spe5644b = str_replace(' ', '', $spe5644b); if (substr($spe5644b, -1, 1) != ';') { $spe5644b = ';' . $spe5644b . ';'; } else { $spe5644b = ';' . $spe5644b; } $sp988e4c = Helper::strBetween($spe5644b, ';' . $spb44bf2 . '=', ';'); if (!$sp56f92d || $sp988e4c == '') { return $sp988e4c; } else { return $spb44bf2 . '=' . $sp988e4c; } } private static function cookieIsExists($spad22e6, $sp94a3ee) { foreach ($spad22e6 as $sp9ee6fd) { if (self::cookieGetName($sp9ee6fd) == $sp94a3ee) { return true; } } return false; } function test() { $sp1c0919 = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($sp1c0919); } }