<?php
require_once 'alipay_core.function.php'; require_once 'alipay_md5.function.php'; class AlipaySubmit { var $alipay_config; var $alipay_gateway_new = 'https://mapi.alipay.com/gateway.do?'; function __construct($sp394da4) { $this->alipay_config = $sp394da4; } function AlipaySubmit($sp394da4) { $this->__construct($sp394da4); } function buildRequestMysign($sp12a9cd) { $spa00b0c = createLinkString($sp12a9cd); $sp69edb5 = ''; switch (strtoupper(trim($this->alipay_config['sign_type']))) { case 'MD5': $sp69edb5 = md5Sign($spa00b0c, $this->alipay_config['key']); break; default: $sp69edb5 = ''; } return $sp69edb5; } function buildRequestPara($spd42b29) { $sp060a75 = paraFilter($spd42b29); $sp12a9cd = argSort($sp060a75); $sp69edb5 = $this->buildRequestMysign($sp12a9cd); $sp12a9cd['sign'] = $sp69edb5; $sp12a9cd['sign_type'] = strtoupper(trim($this->alipay_config['sign_type'])); return $sp12a9cd; } function buildRequestParaToString($spd42b29) { $sp73565c = $this->buildRequestPara($spd42b29); $spff1e1f = createLinkStringUrlEncode($sp73565c); return $spff1e1f; } function buildRequestForm($spd42b29, $spc24a77, $spfa2f21) { $sp73565c = $this->buildRequestPara($spd42b29); $spa6fcfd = '<form id=\'alipaysubmit\' name=\'alipaysubmit\' action=\'' . $this->alipay_gateway_new . '_input_charset=' . trim(strtolower($this->alipay_config['input_charset'])) . '\' method=\'' . $spc24a77 . '\'>'; foreach ($sp73565c as $sp63ae76 => $sp679ba2) { $spa6fcfd .= '<input type=\'hidden\' name=\'' . $sp63ae76 . '\' value=\'' . $sp679ba2 . '\'/>'; } $spa6fcfd = $spa6fcfd . '<input type=\'submit\'  value=\'' . $spfa2f21 . '\' style=\'display:none;\'></form>'; $spa6fcfd = $spa6fcfd . '<script>document.forms[\'alipaysubmit\'].submit();</script>'; return $spa6fcfd; } function query_timestamp() { $sp833b34 = $this->alipay_gateway_new . 'service=query_timestamp&partner=' . trim(strtolower($this->alipay_config['partner'])) . '&_input_charset=' . trim(strtolower($this->alipay_config['input_charset'])); $sp8d6adf = ''; $sp9a0a80 = new DOMDocument(); $sp9a0a80->load($sp833b34); $sp61cab3 = $sp9a0a80->getElementsByTagName('encrypt_key'); $sp8d6adf = $sp61cab3->item(0)->nodeValue; return $sp8d6adf; } }