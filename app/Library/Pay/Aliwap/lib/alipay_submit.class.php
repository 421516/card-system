<?php
require_once 'alipay_core.function.php'; require_once 'alipay_md5.function.php'; class AlipaySubmit { var $alipay_config; var $alipay_gateway_new = 'https://mapi.alipay.com/gateway.do?'; function __construct($sp233f0d) { $this->alipay_config = $sp233f0d; } function AlipaySubmit($sp233f0d) { $this->__construct($sp233f0d); } function buildRequestMysign($sp0411d0) { $spb88d44 = createLinkString($sp0411d0); $sp08f06d = ''; switch (strtoupper(trim($this->alipay_config['sign_type']))) { case 'MD5': $sp08f06d = md5Sign($spb88d44, $this->alipay_config['key']); break; default: $sp08f06d = ''; } return $sp08f06d; } function buildRequestPara($sp1a550c) { $sp231fce = paraFilter($sp1a550c); $sp0411d0 = argSort($sp231fce); $sp08f06d = $this->buildRequestMysign($sp0411d0); $sp0411d0['sign'] = $sp08f06d; $sp0411d0['sign_type'] = strtoupper(trim($this->alipay_config['sign_type'])); return $sp0411d0; } function buildRequestParaToString($sp1a550c) { $sp897196 = $this->buildRequestPara($sp1a550c); $sp248e0d = createLinkStringUrlEncode($sp897196); return $sp248e0d; } function buildRequestForm($sp1a550c, $spf9cb1e, $sp439106) { $sp897196 = $this->buildRequestPara($sp1a550c); $spb9f293 = '<form id=\'alipaysubmit\' name=\'alipaysubmit\' action=\'' . $this->alipay_gateway_new . '_input_charset=' . trim(strtolower($this->alipay_config['input_charset'])) . '\' method=\'' . $spf9cb1e . '\'>'; foreach ($sp897196 as $spfcd1b0 => $sp1f05d8) { $spb9f293 .= '<input type=\'hidden\' name=\'' . $spfcd1b0 . '\' value=\'' . $sp1f05d8 . '\'/>'; } $spb9f293 = $spb9f293 . '<input type=\'submit\'  value=\'' . $sp439106 . '\' style=\'display:none;\'></form>'; $spb9f293 = $spb9f293 . '<script>document.forms[\'alipaysubmit\'].submit();</script>'; return $spb9f293; } function query_timestamp() { $sp78f833 = $this->alipay_gateway_new . 'service=query_timestamp&partner=' . trim(strtolower($this->alipay_config['partner'])) . '&_input_charset=' . trim(strtolower($this->alipay_config['input_charset'])); $sp9be4d2 = ''; $spf147a5 = new DOMDocument(); $spf147a5->load($sp78f833); $spd45595 = $spf147a5->getElementsByTagName('encrypt_key'); $sp9be4d2 = $spd45595->item(0)->nodeValue; return $sp9be4d2; } }