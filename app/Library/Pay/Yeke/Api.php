<?php
namespace App\Library\Pay\Yeke; use App\Library\Pay\ApiInterface; class Api implements ApiInterface { private $url_notify = ''; private $url_return = ''; public function __construct($spfc3b4d) { $this->url_notify = SYS_URL_API . '/pay/notify/' . $spfc3b4d; $this->url_return = SYS_URL . '/pay/return/' . $spfc3b4d; } function goPay($sp8abf69, $spbd054b, $sp547016, $speb838e, $sp6c12fc) { $spbd56f5 = sprintf('%.2f', $sp6c12fc / 100); define('yeke_USER_ID', $sp8abf69['id']); define('yeke_USER_KEY', $sp8abf69['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); $sp50782f = strtolower($sp8abf69['payway']); $sp537b5f = ''; $sp168a39 = ''; if ($sp50782f == 'alipay' || $sp50782f == 'alipay_wap') { $sp537b5f = 'alipay'; $sp168a39 = 'ALIPAY'; } elseif ($sp50782f == 'tenpay' || $sp50782f == 'tenpay_wap') { $sp537b5f = 'tenpay'; $sp168a39 = 'TENPAY'; } elseif ($sp50782f == 'weixin') { $sp537b5f = 'weixin'; $sp168a39 = 'WEIXIN'; } elseif ($sp50782f == 'weixin_wap') { $sp537b5f = 'wxwap'; $sp168a39 = 'wxwap'; } elseif ($sp50782f == 'qq' || $sp50782f == 'qq_wap') { $sp537b5f = 'sqzf'; $sp168a39 = 'sqzf'; } elseif ($sp50782f == 'qq_wap') { $sp537b5f = 'sqzfqb'; $sp168a39 = 'sqzfqb'; } require 'yekeApiLib.php'; require 'HttpClient.php'; $sp547016 = mb_substr($sp547016, 0, 50, 'UTF-8'); $speb838e = mb_substr($speb838e, 0, 100, 'UTF-8'); $spb9d69c = array('P_orderid' => $spbd054b, 'P_paymoney' => $spbd56f5, 'P_productname' => urlencode($sp547016), 'P_productinfo' => urlencode($speb838e), 'P_remark' => urlencode($spbd054b), 'P_custom_1' => urlencode($sp168a39), 'P_custom_2' => '', 'P_contact' => urlencode(SYS_NAME), 'P_paytype' => $sp537b5f, 'P_gateway' => $sp168a39, 'P_cardnum' => '', 'P_cardpwd' => '', 'P_cardvalue' => '', 'P_notify_url' => $this->url_notify, 'P_return_url' => $this->url_return . '/' . $spbd054b); $sp34c0cb = new \yekeAPI(); $spbcb528 = $sp34c0cb->payGate($spb9d69c); echo $spbcb528; } function verify($sp8abf69, $spc98f69) { $spdcb97c = isset($sp8abf69['isNotify']) && $sp8abf69['isNotify']; define('yeke_USER_ID', $sp8abf69['id']); define('yeke_USER_KEY', $sp8abf69['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); require 'HttpClient.php'; require 'yekeApiLib.php'; $sp34c0cb = new \yekeAPI(); if ($spdcb97c) { $spbcb528 = $sp34c0cb->verifyNotify(); } else { $spbcb528 = $sp34c0cb->verifyReturn(); } if ($spbcb528) { $sp26355a = $_REQUEST['P_orderid']; $sp66e744 = $_REQUEST['P_api_orderid']; $spf192ab = $_REQUEST['P_money']; if ($_REQUEST['P_status'] == 'SUCCESS') { $spc98f69($sp66e744, (int) ($spf192ab * 100), $sp26355a); if ($spdcb97c) { echo 'success'; } return true; } else { if ($spdcb97c) { echo '失败订单'; } } } else { if ($spdcb97c) { echo '验证失败'; } } return false; } }