<?php
namespace App\Library\Pay\Yeke; use App\Library\Pay\ApiInterface; class Api implements ApiInterface { private $url_notify = ''; private $url_return = ''; public function __construct($sp3a2be3) { $this->url_notify = SYS_URL_API . '/pay/notify/' . $sp3a2be3; $this->url_return = SYS_URL . '/pay/return/' . $sp3a2be3; } function goPay($sp45b2a0, $spd184e1, $sp873da9, $sp33eb4d, $sp521b2c) { $sp983f6f = sprintf('%.2f', $sp521b2c / 100); define('yeke_USER_ID', $sp45b2a0['id']); define('yeke_USER_KEY', $sp45b2a0['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); $spa27512 = strtolower($sp45b2a0['payway']); $sp5b2a4b = ''; $spcd47e5 = ''; if ($spa27512 == 'alipay' || $spa27512 == 'alipay_wap') { $sp5b2a4b = 'alipay'; $spcd47e5 = 'ALIPAY'; } elseif ($spa27512 == 'tenpay' || $spa27512 == 'tenpay_wap') { $sp5b2a4b = 'tenpay'; $spcd47e5 = 'TENPAY'; } elseif ($spa27512 == 'weixin') { $sp5b2a4b = 'weixin'; $spcd47e5 = 'WEIXIN'; } elseif ($spa27512 == 'weixin_wap') { $sp5b2a4b = 'wxwap'; $spcd47e5 = 'wxwap'; } elseif ($spa27512 == 'qq' || $spa27512 == 'qq_wap') { $sp5b2a4b = 'sqzf'; $spcd47e5 = 'sqzf'; } elseif ($spa27512 == 'qq_wap') { $sp5b2a4b = 'sqzfqb'; $spcd47e5 = 'sqzfqb'; } require 'yekeApiLib.php'; require 'HttpClient.php'; $sp873da9 = mb_substr($sp873da9, 0, 50, 'UTF-8'); $sp33eb4d = mb_substr($sp33eb4d, 0, 100, 'UTF-8'); $spf44b7f = array('P_orderid' => $spd184e1, 'P_paymoney' => $sp983f6f, 'P_productname' => urlencode($sp873da9), 'P_productinfo' => urlencode($sp33eb4d), 'P_remark' => urlencode($spd184e1), 'P_custom_1' => urlencode($spcd47e5), 'P_custom_2' => '', 'P_contact' => urlencode(SYS_NAME), 'P_paytype' => $sp5b2a4b, 'P_gateway' => $spcd47e5, 'P_cardnum' => '', 'P_cardpwd' => '', 'P_cardvalue' => '', 'P_notify_url' => $this->url_notify, 'P_return_url' => $this->url_return . '/' . $spd184e1); $sp90c94a = new \yekeAPI(); $spcc4042 = $sp90c94a->payGate($spf44b7f); echo $spcc4042; } function verify($sp45b2a0, $spf85c0e) { $sp5c8ce2 = isset($sp45b2a0['isNotify']) && $sp45b2a0['isNotify']; define('yeke_USER_ID', $sp45b2a0['id']); define('yeke_USER_KEY', $sp45b2a0['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); require 'HttpClient.php'; require 'yekeApiLib.php'; $sp90c94a = new \yekeAPI(); if ($sp5c8ce2) { $spcc4042 = $sp90c94a->verifyNotify(); } else { $spcc4042 = $sp90c94a->verifyReturn(); } if ($spcc4042) { $sp54c7f0 = $_REQUEST['P_orderid']; $spe1872e = $_REQUEST['P_api_orderid']; $sp64036c = $_REQUEST['P_money']; if ($_REQUEST['P_status'] == 'SUCCESS') { $spf85c0e($spe1872e, (int) ($sp64036c * 100), $sp54c7f0); if ($sp5c8ce2) { echo 'success'; } return true; } else { if ($sp5c8ce2) { echo '失败订单'; } } } else { if ($sp5c8ce2) { echo '验证失败'; } } return false; } }