<?php
namespace App\Library\Pay\Yeke; use App\Library\Pay\ApiInterface; class Api implements ApiInterface { private $url_notify = ''; private $url_return = ''; public function __construct($spf46c5d) { $this->url_notify = SYS_URL_API . '/pay/notify/' . $spf46c5d; $this->url_return = SYS_URL . '/pay/return/' . $spf46c5d; } function goPay($spa9e109, $sp206d07, $sp89af34, $sp92f0c1, $sp28f24f) { $sp9a8a75 = sprintf('%.2f', $sp28f24f / 100); define('yeke_USER_ID', $spa9e109['id']); define('yeke_USER_KEY', $spa9e109['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); $sp266966 = strtolower($spa9e109['payway']); $sp212c30 = ''; $sp0dc15f = ''; if ($sp266966 == 'alipay' || $sp266966 == 'alipay_wap') { $sp212c30 = 'alipay'; $sp0dc15f = 'ALIPAY'; } elseif ($sp266966 == 'tenpay' || $sp266966 == 'tenpay_wap') { $sp212c30 = 'tenpay'; $sp0dc15f = 'TENPAY'; } elseif ($sp266966 == 'weixin') { $sp212c30 = 'weixin'; $sp0dc15f = 'WEIXIN'; } elseif ($sp266966 == 'weixin_wap') { $sp212c30 = 'wxwap'; $sp0dc15f = 'wxwap'; } elseif ($sp266966 == 'qq' || $sp266966 == 'qq_wap') { $sp212c30 = 'sqzf'; $sp0dc15f = 'sqzf'; } elseif ($sp266966 == 'qq_wap') { $sp212c30 = 'sqzfqb'; $sp0dc15f = 'sqzfqb'; } require 'yekeApiLib.php'; require 'HttpClient.php'; $sp89af34 = mb_substr($sp89af34, 0, 50, 'UTF-8'); $sp92f0c1 = mb_substr($sp92f0c1, 0, 100, 'UTF-8'); $sp20678b = array('P_orderid' => $sp206d07, 'P_paymoney' => $sp9a8a75, 'P_productname' => urlencode($sp89af34), 'P_productinfo' => urlencode($sp92f0c1), 'P_remark' => urlencode($sp206d07), 'P_custom_1' => urlencode($sp0dc15f), 'P_custom_2' => '', 'P_contact' => urlencode(SYS_NAME), 'P_paytype' => $sp212c30, 'P_gateway' => $sp0dc15f, 'P_cardnum' => '', 'P_cardpwd' => '', 'P_cardvalue' => '', 'P_notify_url' => $this->url_notify, 'P_return_url' => $this->url_return . '/' . $sp206d07); $sp00ae37 = new \yekeAPI(); $sp9610ab = $sp00ae37->payGate($sp20678b); echo $sp9610ab; } function verify($spa9e109, $spf8927a) { $spf53f48 = isset($spa9e109['isNotify']) && $spa9e109['isNotify']; define('yeke_USER_ID', $spa9e109['id']); define('yeke_USER_KEY', $spa9e109['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); require 'HttpClient.php'; require 'yekeApiLib.php'; $sp00ae37 = new \yekeAPI(); if ($spf53f48) { $sp9610ab = $sp00ae37->verifyNotify(); } else { $sp9610ab = $sp00ae37->verifyReturn(); } if ($sp9610ab) { $sp0ba5ac = $_REQUEST['P_orderid']; $sp9ab7e9 = $_REQUEST['P_api_orderid']; $sp0c63d8 = $_REQUEST['P_money']; if ($_REQUEST['P_status'] == 'SUCCESS') { $spf8927a($sp9ab7e9, (int) round($sp0c63d8 * 100), $sp0ba5ac); if ($spf53f48) { echo 'success'; } return true; } else { if ($spf53f48) { echo '失败订单'; } } } else { if ($spf53f48) { echo '验证失败'; } } return false; } }