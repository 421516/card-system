<?php
namespace App\Library\Pay\Yeke; use App\Library\Pay\ApiInterface; class Api implements ApiInterface { private $url_notify = ''; private $url_return = ''; public function __construct($spe6149b) { $this->url_notify = SYS_URL_API . '/pay/notify/' . $spe6149b; $this->url_return = SYS_URL . '/pay/return/' . $spe6149b; } function goPay($spd82bcd, $sp6281ad, $spe4243d, $sp1d246b, $sp54eead) { $sp90753f = sprintf('%.2f', $sp54eead / 100); define('yeke_USER_ID', $spd82bcd['id']); define('yeke_USER_KEY', $spd82bcd['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); $spabb601 = strtolower($spd82bcd['payway']); $spbcd86e = ''; $sp81c9d2 = ''; if ($spabb601 == 'alipay' || $spabb601 == 'alipay_wap') { $spbcd86e = 'alipay'; $sp81c9d2 = 'ALIPAY'; } elseif ($spabb601 == 'tenpay' || $spabb601 == 'tenpay_wap') { $spbcd86e = 'tenpay'; $sp81c9d2 = 'TENPAY'; } elseif ($spabb601 == 'weixin') { $spbcd86e = 'weixin'; $sp81c9d2 = 'WEIXIN'; } elseif ($spabb601 == 'weixin_wap') { $spbcd86e = 'wxwap'; $sp81c9d2 = 'wxwap'; } elseif ($spabb601 == 'qq' || $spabb601 == 'qq_wap') { $spbcd86e = 'sqzf'; $sp81c9d2 = 'sqzf'; } elseif ($spabb601 == 'qq_wap') { $spbcd86e = 'sqzfqb'; $sp81c9d2 = 'sqzfqb'; } require 'yekeApiLib.php'; require 'HttpClient.php'; $spe4243d = mb_substr($spe4243d, 0, 50, 'UTF-8'); $sp1d246b = mb_substr($sp1d246b, 0, 100, 'UTF-8'); $sp31ee10 = array('P_orderid' => $sp6281ad, 'P_paymoney' => $sp90753f, 'P_productname' => urlencode($spe4243d), 'P_productinfo' => urlencode($sp1d246b), 'P_remark' => urlencode($sp6281ad), 'P_custom_1' => urlencode($sp81c9d2), 'P_custom_2' => '', 'P_contact' => urlencode(SYS_NAME), 'P_paytype' => $spbcd86e, 'P_gateway' => $sp81c9d2, 'P_cardnum' => '', 'P_cardpwd' => '', 'P_cardvalue' => '', 'P_notify_url' => $this->url_notify, 'P_return_url' => $this->url_return . '/' . $sp6281ad); $spf8813d = new \yekeAPI(); $sp836ce6 = $spf8813d->payGate($sp31ee10); echo $sp836ce6; } function verify($spd82bcd, $spbb5f38) { $spe16bd1 = isset($spd82bcd['isNotify']) && $spd82bcd['isNotify']; define('yeke_USER_ID', $spd82bcd['id']); define('yeke_USER_KEY', $spd82bcd['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); require 'HttpClient.php'; require 'yekeApiLib.php'; $spf8813d = new \yekeAPI(); if ($spe16bd1) { $sp836ce6 = $spf8813d->verifyNotify(); } else { $sp836ce6 = $spf8813d->verifyReturn(); } if ($sp836ce6) { $spdac442 = $_REQUEST['P_orderid']; $sp5d5e7d = $_REQUEST['P_api_orderid']; $sp51ebf3 = $_REQUEST['P_money']; if ($_REQUEST['P_status'] == 'SUCCESS') { $spbb5f38($sp5d5e7d, (int) ($sp51ebf3 * 100), $spdac442); if ($spe16bd1) { echo 'success'; } return true; } else { if ($spe16bd1) { echo '失败订单'; } } } else { if ($spe16bd1) { echo '验证失败'; } } return false; } }