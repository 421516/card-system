<?php
require_once 'qpayMch.config.php'; class QpayMchUtil { public static function createNoncestr($spef2f8c = 32) { $spb28d0f = 'abcdefghijklmnopqrstuvwxyz0123456789'; $spdeb044 = ''; for ($spfae064 = 0; $spfae064 < $spef2f8c; $spfae064++) { $spdeb044 .= substr($spb28d0f, mt_rand(0, strlen($spb28d0f) - 1), 1); } return $spdeb044; } public static function buildQueryStr($sp50fc45) { $sp1ede14 = array(); foreach ($sp50fc45 as $sp08a7aa => $sp99652d) { if ($sp08a7aa != 'sign' && $sp99652d != '' && !is_array($sp99652d)) { array_push($sp1ede14, "{$sp08a7aa}={$sp99652d}"); } } return implode('&', $sp1ede14); } public static function getSign($sp50fc45, $spa96334) { ksort($sp50fc45); $sp4e4932 = QpayMchUtil::buildQueryStr($sp50fc45); $sp4e4932 = $sp4e4932 . '&key=' . $spa96334; $sp4e4932 = md5($sp4e4932); $sp26d1d6 = strtoupper($sp4e4932); return $sp26d1d6; } public static function arrayToXml($spf35f50) { $sp1eeb26 = '<xml>'; foreach ($spf35f50 as $spfcd1b0 => $sp1f05d8) { if (is_numeric($sp1f05d8)) { $sp1eeb26 .= "<{$spfcd1b0}>{$sp1f05d8}</{$spfcd1b0}>"; } else { $sp1eeb26 .= "<{$spfcd1b0}><![CDATA[{$sp1f05d8}]]></{$spfcd1b0}>"; } } $sp1eeb26 .= '</xml>'; return $sp1eeb26; } public static function xmlToArray($sp1eeb26) { $spf35f50 = json_decode(json_encode(simplexml_load_string($sp1eeb26, 'SimpleXMLElement', LIBXML_NOCDATA)), true); return $spf35f50; } public static function reqByCurlNormalPost($sp50fc45, $sp78f833, $spa1cdba = 10) { return QpayMchUtil::_reqByCurl($sp50fc45, $sp78f833, $spa1cdba, false); } public static function reqByCurlSSLPost($sp50fc45, $sp78f833, $spa1cdba = 10) { return QpayMchUtil::_reqByCurl($sp50fc45, $sp78f833, $spa1cdba, true); } private static function _reqByCurl($sp50fc45, $sp78f833, $spa1cdba = 10, $spb88e37 = false) { $sp7a336f = curl_init(); curl_setopt($sp7a336f, CURLOPT_URL, $sp78f833); curl_setopt($sp7a336f, CURLOPT_TIMEOUT, $spa1cdba); curl_setopt($sp7a336f, CURLOPT_SSL_VERIFYPEER, FALSE); curl_setopt($sp7a336f, CURLOPT_SSL_VERIFYHOST, FALSE); curl_setopt($sp7a336f, CURLOPT_HEADER, FALSE); curl_setopt($sp7a336f, CURLOPT_RETURNTRANSFER, TRUE); if (isset($spb88e37) && $spb88e37 != false) { curl_setopt($sp7a336f, CURLOPT_SSLCERTTYPE, 'PEM'); curl_setopt($sp7a336f, CURLOPT_SSLCERT, QpayMchConf::CERT_FILE_PATH); curl_setopt($sp7a336f, CURLOPT_SSLKEYTYPE, 'PEM'); curl_setopt($sp7a336f, CURLOPT_SSLKEY, QpayMchConf::KEY_FILE_PATH); } curl_setopt($sp7a336f, CURLOPT_POST, true); curl_setopt($sp7a336f, CURLOPT_POSTFIELDS, $sp50fc45); $sp123706 = curl_exec($sp7a336f); if ($sp123706) { curl_close($sp7a336f); return $sp123706; } else { $sp4c188b = curl_errno($sp7a336f); print_r($sp4c188b); curl_close($sp7a336f); return false; } } }