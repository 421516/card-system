<?php
require_once 'qpayMchUtil.class.php'; class QpayMchAPI { protected $url; protected $isSSL; protected $timeout; public function __construct($sp11a0e0, $sp68986c, $sp9532e1 = 5) { $this->url = $sp11a0e0; $this->isSSL = $sp68986c; $this->timeout = $sp9532e1; } public function notify_params() { $sp2b62c7 = file_get_contents('php://input'); return QpayMchUtil::xmlToArray($sp2b62c7); } public function notify_verify($sp20678b, $spa9e109) { if (!isset($sp20678b['sign'])) { return false; } $sp9c9a88 = QpayMchUtil::getSign($sp20678b, $spa9e109['mch_key']); return $sp9c9a88 === $sp20678b['sign']; } public function req($sp20678b, $spa9e109) { $sp5780b9 = array(); $sp20678b['mch_id'] = $spa9e109['mch_id']; $sp20678b['nonce_str'] = QpayMchUtil::createNoncestr(); $sp20678b['sign'] = QpayMchUtil::getSign($sp20678b, $spa9e109['mch_key']); $sp2b62c7 = QpayMchUtil::arrayToXml($sp20678b); if (isset($this->isSSL)) { $sp5780b9 = QpayMchUtil::reqByCurlSSLPost($sp2b62c7, $this->url, $this->timeout); } else { $sp5780b9 = QpayMchUtil::reqByCurlNormalPost($sp2b62c7, $this->url, $this->timeout); } return $sp5780b9; } }