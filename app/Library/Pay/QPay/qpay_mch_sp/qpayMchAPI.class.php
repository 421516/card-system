<?php
require_once 'qpayMchUtil.class.php'; class QpayMchAPI { protected $url; protected $isSSL; protected $timeout; public function __construct($sp833b34, $sp0fd06d, $sp1ca900 = 5) { $this->url = $sp833b34; $this->isSSL = $sp0fd06d; $this->timeout = $sp1ca900; } public function notify_params() { $sp01b3bc = file_get_contents('php://input'); return QpayMchUtil::xmlToArray($sp01b3bc); } public function notify_verify($sp31ee10, $spd82bcd) { if (!isset($sp31ee10['sign'])) { return false; } $sp36c1ea = QpayMchUtil::getSign($sp31ee10, $spd82bcd['mch_key']); return $sp36c1ea === $sp31ee10['sign']; } public function req($sp31ee10, $spd82bcd) { $sp46dd86 = array(); $sp31ee10['mch_id'] = $spd82bcd['mch_id']; $sp31ee10['nonce_str'] = QpayMchUtil::createNoncestr(); $sp31ee10['sign'] = QpayMchUtil::getSign($sp31ee10, $spd82bcd['mch_key']); $sp01b3bc = QpayMchUtil::arrayToXml($sp31ee10); if (isset($this->isSSL)) { $sp46dd86 = QpayMchUtil::reqByCurlSSLPost($sp01b3bc, $this->url, $this->timeout); } else { $sp46dd86 = QpayMchUtil::reqByCurlNormalPost($sp01b3bc, $this->url, $this->timeout); } return $sp46dd86; } }