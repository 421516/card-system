<?php
ini_set('date.timezone', 'Asia/Shanghai'); error_reporting(E_ERROR); require_once '../lib/WxPay.Api.php'; require_once '../lib/WxPay.Notify.php'; require_once '../WxLog.php'; class PayNotifyCallBack extends WxPayNotify { public function Queryorder($sp428e5f) { $spd2b050 = new WxPayOrderQuery(); $spd2b050->SetTransaction_id($sp428e5f); $sp9610ab = WxPayApi::orderQuery($spd2b050); \WxLog::DEBUG('query:' . json_encode($sp9610ab)); if (array_key_exists('return_code', $sp9610ab) && array_key_exists('result_code', $sp9610ab) && $sp9610ab['return_code'] == 'SUCCESS' && $sp9610ab['result_code'] == 'SUCCESS') { return true; } return false; } public function NotifyProcess($sp29e0c7, &$spdfd2b6) { \WxLog::DEBUG('call back:' . json_encode($sp29e0c7)); $spbb7487 = array(); if (!array_key_exists('transaction_id', $sp29e0c7)) { $spdfd2b6 = '输入参数不正确'; return false; } if (!$this->Queryorder($sp29e0c7['transaction_id'])) { $spdfd2b6 = '订单查询失败'; return false; } return true; } } \WxLog::DEBUG('begin notify'); $sp390b71 = new PayNotifyCallBack(); $sp390b71->Handle(false);