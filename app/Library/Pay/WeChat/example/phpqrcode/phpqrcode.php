<?php
define('QR_MODE_NUL', -1); define('QR_MODE_NUM', 0); define('QR_MODE_AN', 1); define('QR_MODE_8', 2); define('QR_MODE_KANJI', 3); define('QR_MODE_STRUCTURE', 4); define('QR_ECLEVEL_L', 0); define('QR_ECLEVEL_M', 1); define('QR_ECLEVEL_Q', 2); define('QR_ECLEVEL_H', 3); define('QR_FORMAT_TEXT', 0); define('QR_FORMAT_PNG', 1); class qrstr { public static function set(&$spabe0c2, $sp112cf5, $sp291441, $sp3b7f92, $spa40df1 = false) { $spabe0c2[$sp291441] = substr_replace($spabe0c2[$sp291441], $spa40df1 !== false ? substr($sp3b7f92, 0, $spa40df1) : $sp3b7f92, $sp112cf5, $spa40df1 !== false ? $spa40df1 : strlen($sp3b7f92)); } } define('QR_CACHEABLE', false); define('QR_CACHE_DIR', false); define('QR_LOG_DIR', false); define('QR_FIND_BEST_MASK', true); define('QR_FIND_FROM_RANDOM', 2); define('QR_DEFAULT_MASK', 2); define('QR_PNG_MAXIMUM_SIZE', 1024); class QRtools { public static function binarize($sp07bae2) { $sp7135ea = count($sp07bae2); foreach ($sp07bae2 as &$sp24bd67) { for ($sp747316 = 0; $sp747316 < $sp7135ea; $sp747316++) { $sp24bd67[$sp747316] = ord($sp24bd67[$sp747316]) & 1 ? '1' : '0'; } } return $sp07bae2; } public static function tcpdfBarcodeArray($spe54fd8, $sp94ed21 = 'QR,L', $sp260402 = '4.5.037') { $sp0fbc4d = array(); if (!is_array($sp94ed21)) { $sp94ed21 = explode(',', $sp94ed21); } $spc8d8e1 = 'L'; if (count($sp94ed21) > 1) { $spc8d8e1 = $sp94ed21[1]; } $sp69fbde = QRcode::text($spe54fd8, false, $spc8d8e1); $sp3d94dd = count($sp69fbde); $sp0fbc4d['num_rows'] = $sp3d94dd; $sp0fbc4d['num_cols'] = $sp3d94dd; $sp0fbc4d['bcode'] = array(); foreach ($sp69fbde as $sp8b5901) { $spdc6b30 = array(); foreach (str_split($sp8b5901) as $spa560dd) { $spdc6b30[] = $spa560dd == '1' ? 1 : 0; } $sp0fbc4d['bcode'][] = $spdc6b30; } return $sp0fbc4d; } public static function clearCache() { self::$frames = array(); } public static function buildCache() { QRtools::markTime('before_build_cache'); $sp759411 = new QRmask(); for ($sp2fcde3 = 1; $sp2fcde3 <= QRSPEC_VERSION_MAX; $sp2fcde3++) { $sp07bae2 = QRspec::newFrame($sp2fcde3); if (QR_IMAGE) { $sp0f1218 = QR_CACHE_DIR . 'frame_' . $sp2fcde3 . '.png'; QRimage::png(self::binarize($sp07bae2), $sp0f1218, 1, 0); } $sp9a79fc = count($sp07bae2); $sp37f74b = array_fill(0, $sp9a79fc, array_fill(0, $sp9a79fc, 0)); for ($sp478685 = 0; $sp478685 < 8; $sp478685++) { $sp759411->makeMaskNo($sp478685, $sp9a79fc, $sp07bae2, $sp37f74b, true); } } QRtools::markTime('after_build_cache'); } public static function log($spbbdd0f, $sp173961) { if (QR_LOG_DIR !== false) { if ($sp173961 != '') { if ($spbbdd0f !== false) { file_put_contents(QR_LOG_DIR . basename($spbbdd0f) . '-errors.txt', date('Y-m-d H:i:s') . ': ' . $sp173961, FILE_APPEND); } else { file_put_contents(QR_LOG_DIR . 'errors.txt', date('Y-m-d H:i:s') . ': ' . $sp173961, FILE_APPEND); } } } } public static function dumpMask($sp07bae2) { $sp9a79fc = count($sp07bae2); for ($sp291441 = 0; $sp291441 < $sp9a79fc; $sp291441++) { for ($sp112cf5 = 0; $sp112cf5 < $sp9a79fc; $sp112cf5++) { echo ord($sp07bae2[$sp291441][$sp112cf5]) . ','; } } } public static function markTime($spcc3681) { list($sp871b0f, $sp2c50fe) = explode(' ', microtime()); $spd97c80 = (double) $sp871b0f + (double) $sp2c50fe; if (!isset($sp16d414['qr_time_bench'])) { $sp16d414['qr_time_bench'] = array(); } $sp16d414['qr_time_bench'][$spcc3681] = $spd97c80; } public static function timeBenchmark() { self::markTime('finish'); $sp03c2a4 = 0; $sp870e7d = 0; $sp065be2 = 0; echo '<table cellpadding="3" cellspacing="1">
                    <thead><tr style="border-bottom:1px solid silver"><td colspan="2" style="text-align:center">BENCHMARK</td></tr></thead>
                    <tbody>'; foreach ($sp16d414['qr_time_bench'] as $spcc3681 => $sp758a45) { if ($sp065be2 > 0) { echo '<tr><th style="text-align:right">till ' . $spcc3681 . ': </th><td>' . number_format($sp758a45 - $sp03c2a4, 6) . 's</td></tr>'; } else { $sp870e7d = $sp758a45; } $sp065be2++; $sp03c2a4 = $sp758a45; } echo '</tbody><tfoot>
                <tr style="border-top:2px solid black"><th style="text-align:right">TOTAL: </th><td>' . number_format($sp03c2a4 - $sp870e7d, 6) . 's</td></tr>
            </tfoot>
            </table>'; } } QRtools::markTime('start'); define('QRSPEC_VERSION_MAX', 40); define('QRSPEC_WIDTH_MAX', 177); define('QRCAP_WIDTH', 0); define('QRCAP_WORDS', 1); define('QRCAP_REMINDER', 2); define('QRCAP_EC', 3); class QRspec { public static $capacity = array(array(0, 0, 0, array(0, 0, 0, 0)), array(21, 26, 0, array(7, 10, 13, 17)), array(25, 44, 7, array(10, 16, 22, 28)), array(29, 70, 7, array(15, 26, 36, 44)), array(33, 100, 7, array(20, 36, 52, 64)), array(37, 134, 7, array(26, 48, 72, 88)), array(41, 172, 7, array(36, 64, 96, 112)), array(45, 196, 0, array(40, 72, 108, 130)), array(49, 242, 0, array(48, 88, 132, 156)), array(53, 292, 0, array(60, 110, 160, 192)), array(57, 346, 0, array(72, 130, 192, 224)), array(61, 404, 0, array(80, 150, 224, 264)), array(65, 466, 0, array(96, 176, 260, 308)), array(69, 532, 0, array(104, 198, 288, 352)), array(73, 581, 3, array(120, 216, 320, 384)), array(77, 655, 3, array(132, 240, 360, 432)), array(81, 733, 3, array(144, 280, 408, 480)), array(85, 815, 3, array(168, 308, 448, 532)), array(89, 901, 3, array(180, 338, 504, 588)), array(93, 991, 3, array(196, 364, 546, 650)), array(97, 1085, 3, array(224, 416, 600, 700)), array(101, 1156, 4, array(224, 442, 644, 750)), array(105, 1258, 4, array(252, 476, 690, 816)), array(109, 1364, 4, array(270, 504, 750, 900)), array(113, 1474, 4, array(300, 560, 810, 960)), array(117, 1588, 4, array(312, 588, 870, 1050)), array(121, 1706, 4, array(336, 644, 952, 1110)), array(125, 1828, 4, array(360, 700, 1020, 1200)), array(129, 1921, 3, array(390, 728, 1050, 1260)), array(133, 2051, 3, array(420, 784, 1140, 1350)), array(137, 2185, 3, array(450, 812, 1200, 1440)), array(141, 2323, 3, array(480, 868, 1290, 1530)), array(145, 2465, 3, array(510, 924, 1350, 1620)), array(149, 2611, 3, array(540, 980, 1440, 1710)), array(153, 2761, 3, array(570, 1036, 1530, 1800)), array(157, 2876, 0, array(570, 1064, 1590, 1890)), array(161, 3034, 0, array(600, 1120, 1680, 1980)), array(165, 3196, 0, array(630, 1204, 1770, 2100)), array(169, 3362, 0, array(660, 1260, 1860, 2220)), array(173, 3532, 0, array(720, 1316, 1950, 2310)), array(177, 3706, 0, array(750, 1372, 2040, 2430))); public static function getDataLength($sp5dc7fe, $spb8f321) { return self::$capacity[$sp5dc7fe][QRCAP_WORDS] - self::$capacity[$sp5dc7fe][QRCAP_EC][$spb8f321]; } public static function getECCLength($sp5dc7fe, $spb8f321) { return self::$capacity[$sp5dc7fe][QRCAP_EC][$spb8f321]; } public static function getWidth($sp5dc7fe) { return self::$capacity[$sp5dc7fe][QRCAP_WIDTH]; } public static function getRemainder($sp5dc7fe) { return self::$capacity[$sp5dc7fe][QRCAP_REMINDER]; } public static function getMinimumVersion($sp3d94dd, $spb8f321) { for ($sp747316 = 1; $sp747316 <= QRSPEC_VERSION_MAX; $sp747316++) { $spdadace = self::$capacity[$sp747316][QRCAP_WORDS] - self::$capacity[$sp747316][QRCAP_EC][$spb8f321]; if ($spdadace >= $sp3d94dd) { return $sp747316; } } return -1; } public static $lengthTableBits = array(array(10, 12, 14), array(9, 11, 13), array(8, 16, 16), array(8, 10, 12)); public static function lengthIndicator($sp94ed21, $sp5dc7fe) { if ($sp94ed21 == QR_MODE_STRUCTURE) { return 0; } if ($sp5dc7fe <= 9) { $sp03c4d6 = 0; } else { if ($sp5dc7fe <= 26) { $sp03c4d6 = 1; } else { $sp03c4d6 = 2; } } return self::$lengthTableBits[$sp94ed21][$sp03c4d6]; } public static function maximumWords($sp94ed21, $sp5dc7fe) { if ($sp94ed21 == QR_MODE_STRUCTURE) { return 3; } if ($sp5dc7fe <= 9) { $sp03c4d6 = 0; } else { if ($sp5dc7fe <= 26) { $sp03c4d6 = 1; } else { $sp03c4d6 = 2; } } $sp48405e = self::$lengthTableBits[$sp94ed21][$sp03c4d6]; $spdadace = (1 << $sp48405e) - 1; if ($sp94ed21 == QR_MODE_KANJI) { $spdadace *= 2; } return $spdadace; } public static $eccTable = array(array(array(0, 0), array(0, 0), array(0, 0), array(0, 0)), array(array(1, 0), array(1, 0), array(1, 0), array(1, 0)), array(array(1, 0), array(1, 0), array(1, 0), array(1, 0)), array(array(1, 0), array(1, 0), array(2, 0), array(2, 0)), array(array(1, 0), array(2, 0), array(2, 0), array(4, 0)), array(array(1, 0), array(2, 0), array(2, 2), array(2, 2)), array(array(2, 0), array(4, 0), array(4, 0), array(4, 0)), array(array(2, 0), array(4, 0), array(2, 4), array(4, 1)), array(array(2, 0), array(2, 2), array(4, 2), array(4, 2)), array(array(2, 0), array(3, 2), array(4, 4), array(4, 4)), array(array(2, 2), array(4, 1), array(6, 2), array(6, 2)), array(array(4, 0), array(1, 4), array(4, 4), array(3, 8)), array(array(2, 2), array(6, 2), array(4, 6), array(7, 4)), array(array(4, 0), array(8, 1), array(8, 4), array(12, 4)), array(array(3, 1), array(4, 5), array(11, 5), array(11, 5)), array(array(5, 1), array(5, 5), array(5, 7), array(11, 7)), array(array(5, 1), array(7, 3), array(15, 2), array(3, 13)), array(array(1, 5), array(10, 1), array(1, 15), array(2, 17)), array(array(5, 1), array(9, 4), array(17, 1), array(2, 19)), array(array(3, 4), array(3, 11), array(17, 4), array(9, 16)), array(array(3, 5), array(3, 13), array(15, 5), array(15, 10)), array(array(4, 4), array(17, 0), array(17, 6), array(19, 6)), array(array(2, 7), array(17, 0), array(7, 16), array(34, 0)), array(array(4, 5), array(4, 14), array(11, 14), array(16, 14)), array(array(6, 4), array(6, 14), array(11, 16), array(30, 2)), array(array(8, 4), array(8, 13), array(7, 22), array(22, 13)), array(array(10, 2), array(19, 4), array(28, 6), array(33, 4)), array(array(8, 4), array(22, 3), array(8, 26), array(12, 28)), array(array(3, 10), array(3, 23), array(4, 31), array(11, 31)), array(array(7, 7), array(21, 7), array(1, 37), array(19, 26)), array(array(5, 10), array(19, 10), array(15, 25), array(23, 25)), array(array(13, 3), array(2, 29), array(42, 1), array(23, 28)), array(array(17, 0), array(10, 23), array(10, 35), array(19, 35)), array(array(17, 1), array(14, 21), array(29, 19), array(11, 46)), array(array(13, 6), array(14, 23), array(44, 7), array(59, 1)), array(array(12, 7), array(12, 26), array(39, 14), array(22, 41)), array(array(6, 14), array(6, 34), array(46, 10), array(2, 64)), array(array(17, 4), array(29, 14), array(49, 10), array(24, 46)), array(array(4, 18), array(13, 32), array(48, 14), array(42, 32)), array(array(20, 4), array(40, 7), array(43, 22), array(10, 67)), array(array(19, 6), array(18, 31), array(34, 34), array(20, 61))); public static function getEccSpec($sp5dc7fe, $spb8f321, array &$speb102b) { if (count($speb102b) < 5) { $speb102b = array(0, 0, 0, 0, 0); } $sp223810 = self::$eccTable[$sp5dc7fe][$spb8f321][0]; $sp7afdb6 = self::$eccTable[$sp5dc7fe][$spb8f321][1]; $sp29e0c7 = self::getDataLength($sp5dc7fe, $spb8f321); $sp57a5ab = self::getECCLength($sp5dc7fe, $spb8f321); if ($sp7afdb6 == 0) { $speb102b[0] = $sp223810; $speb102b[1] = (int) ($sp29e0c7 / $sp223810); $speb102b[2] = (int) ($sp57a5ab / $sp223810); $speb102b[3] = 0; $speb102b[4] = 0; } else { $speb102b[0] = $sp223810; $speb102b[1] = (int) ($sp29e0c7 / ($sp223810 + $sp7afdb6)); $speb102b[2] = (int) ($sp57a5ab / ($sp223810 + $sp7afdb6)); $speb102b[3] = $sp7afdb6; $speb102b[4] = $speb102b[1] + 1; } } public static $alignmentPattern = array(array(0, 0), array(0, 0), array(18, 0), array(22, 0), array(26, 0), array(30, 0), array(34, 0), array(22, 38), array(24, 42), array(26, 46), array(28, 50), array(30, 54), array(32, 58), array(34, 62), array(26, 46), array(26, 48), array(26, 50), array(30, 54), array(30, 56), array(30, 58), array(34, 62), array(28, 50), array(26, 50), array(30, 54), array(28, 54), array(32, 58), array(30, 58), array(34, 62), array(26, 50), array(30, 54), array(26, 52), array(30, 56), array(34, 60), array(30, 58), array(34, 62), array(30, 54), array(24, 50), array(28, 54), array(32, 58), array(26, 54), array(30, 58)); public static function putAlignmentMarker(array &$sp07bae2, $sp2dd4bb, $spc05849) { $spc7e024 = array('°°°°°', '°†††°', '°†°†°', '°†††°', '°°°°°'); $sp8c4c39 = $spc05849 - 2; $sp16cee8 = $sp2dd4bb - 2; for ($sp291441 = 0; $sp291441 < 5; $sp291441++) { QRstr::set($sp07bae2, $sp16cee8, $sp8c4c39 + $sp291441, $spc7e024[$sp291441]); } } public static function putAlignmentPattern($sp5dc7fe, &$sp07bae2, $sp9a79fc) { if ($sp5dc7fe < 2) { return; } $spbc28f6 = self::$alignmentPattern[$sp5dc7fe][1] - self::$alignmentPattern[$sp5dc7fe][0]; if ($spbc28f6 < 0) { $spdd144e = 2; } else { $spdd144e = (int) (($sp9a79fc - self::$alignmentPattern[$sp5dc7fe][0]) / $spbc28f6 + 2); } if ($spdd144e * $spdd144e - 3 == 1) { $sp112cf5 = self::$alignmentPattern[$sp5dc7fe][0]; $sp291441 = self::$alignmentPattern[$sp5dc7fe][0]; self::putAlignmentMarker($sp07bae2, $sp112cf5, $sp291441); return; } $sp9ddac7 = self::$alignmentPattern[$sp5dc7fe][0]; for ($sp112cf5 = 1; $sp112cf5 < $spdd144e - 1; $sp112cf5++) { self::putAlignmentMarker($sp07bae2, 6, $sp9ddac7); self::putAlignmentMarker($sp07bae2, $sp9ddac7, 6); $sp9ddac7 += $spbc28f6; } $sp4b8bf2 = self::$alignmentPattern[$sp5dc7fe][0]; for ($sp291441 = 0; $sp291441 < $spdd144e - 1; $sp291441++) { $sp9ddac7 = self::$alignmentPattern[$sp5dc7fe][0]; for ($sp112cf5 = 0; $sp112cf5 < $spdd144e - 1; $sp112cf5++) { self::putAlignmentMarker($sp07bae2, $sp9ddac7, $sp4b8bf2); $sp9ddac7 += $spbc28f6; } $sp4b8bf2 += $spbc28f6; } } public static $versionPattern = array(31892, 34236, 39577, 42195, 48118, 51042, 55367, 58893, 63784, 68472, 70749, 76311, 79154, 84390, 87683, 92361, 96236, 102084, 102881, 110507, 110734, 117786, 119615, 126325, 127568, 133589, 136944, 141498, 145311, 150283, 152622, 158308, 161089, 167017); public static function getVersionPattern($sp5dc7fe) { if ($sp5dc7fe < 7 || $sp5dc7fe > QRSPEC_VERSION_MAX) { return 0; } return self::$versionPattern[$sp5dc7fe - 7]; } public static $formatInfo = array(array(30660, 29427, 32170, 30877, 26159, 25368, 27713, 26998), array(21522, 20773, 24188, 23371, 17913, 16590, 20375, 19104), array(13663, 12392, 16177, 14854, 9396, 8579, 11994, 11245), array(5769, 5054, 7399, 6608, 1890, 597, 3340, 2107)); public static function getFormatInfo($sp759411, $spb8f321) { if ($sp759411 < 0 || $sp759411 > 7) { return 0; } if ($spb8f321 < 0 || $spb8f321 > 3) { return 0; } return self::$formatInfo[$spb8f321][$sp759411]; } public static $frames = array(); public static function putFinderPattern(&$sp07bae2, $sp2dd4bb, $spc05849) { $spc7e024 = array('¡¡¡¡¡¡¡', '¡¿¿¿¿¿¡', '¡¿¡¡¡¿¡', '¡¿¡¡¡¿¡', '¡¿¡¡¡¿¡', '¡¿¿¿¿¿¡', '¡¡¡¡¡¡¡'); for ($sp291441 = 0; $sp291441 < 7; $sp291441++) { QRstr::set($sp07bae2, $sp2dd4bb, $spc05849 + $sp291441, $spc7e024[$sp291441]); } } public static function createFrame($sp5dc7fe) { $sp9a79fc = self::$capacity[$sp5dc7fe][QRCAP_WIDTH]; $sp24bd67 = str_repeat(' ', $sp9a79fc); $sp07bae2 = array_fill(0, $sp9a79fc, $sp24bd67); self::putFinderPattern($sp07bae2, 0, 0); self::putFinderPattern($sp07bae2, $sp9a79fc - 7, 0); self::putFinderPattern($sp07bae2, 0, $sp9a79fc - 7); $sp84d1a3 = $sp9a79fc - 7; for ($sp291441 = 0; $sp291441 < 7; $sp291441++) { $sp07bae2[$sp291441][7] = '¿'; $sp07bae2[$sp291441][$sp9a79fc - 8] = '¿'; $sp07bae2[$sp84d1a3][7] = '¿'; $sp84d1a3++; } $sp1a7671 = str_repeat('¿', 8); QRstr::set($sp07bae2, 0, 7, $sp1a7671); QRstr::set($sp07bae2, $sp9a79fc - 8, 7, $sp1a7671); QRstr::set($sp07bae2, 0, $sp9a79fc - 8, $sp1a7671); $sp1a7671 = str_repeat('Ñ', 9); QRstr::set($sp07bae2, 0, 8, $sp1a7671); QRstr::set($sp07bae2, $sp9a79fc - 8, 8, $sp1a7671, 8); $sp84d1a3 = $sp9a79fc - 8; for ($sp291441 = 0; $sp291441 < 8; $sp291441++, $sp84d1a3++) { $sp07bae2[$sp291441][8] = 'Ñ'; $sp07bae2[$sp84d1a3][8] = 'Ñ'; } for ($sp747316 = 1; $sp747316 < $sp9a79fc - 15; $sp747316++) { $sp07bae2[6][7 + $sp747316] = chr(144 | $sp747316 & 1); $sp07bae2[7 + $sp747316][6] = chr(144 | $sp747316 & 1); } self::putAlignmentPattern($sp5dc7fe, $sp07bae2, $sp9a79fc); if ($sp5dc7fe >= 7) { $sp312f6a = self::getVersionPattern($sp5dc7fe); $sp154f6e = $sp312f6a; for ($sp112cf5 = 0; $sp112cf5 < 6; $sp112cf5++) { for ($sp291441 = 0; $sp291441 < 3; $sp291441++) { $sp07bae2[$sp9a79fc - 11 + $sp291441][$sp112cf5] = chr(136 | $sp154f6e & 1); $sp154f6e = $sp154f6e >> 1; } } $sp154f6e = $sp312f6a; for ($sp291441 = 0; $sp291441 < 6; $sp291441++) { for ($sp112cf5 = 0; $sp112cf5 < 3; $sp112cf5++) { $sp07bae2[$sp291441][$sp112cf5 + ($sp9a79fc - 11)] = chr(136 | $sp154f6e & 1); $sp154f6e = $sp154f6e >> 1; } } } $sp07bae2[$sp9a79fc - 8][8] = 'Å'; return $sp07bae2; } public static function debug($sp07bae2, $spc33961 = false) { if ($spc33961) { foreach ($sp07bae2 as &$sp24bd67) { $sp24bd67 = join('<span class="m">&nbsp;&nbsp;</span>', explode('0', $sp24bd67)); $sp24bd67 = join('&#9608;&#9608;', explode('1', $sp24bd67)); } ?>
                <style>
                    .m { background-color: white; }
                </style>
                <?php  echo '<pre><tt><br/ ><br/ ><br/ >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'; echo join('<br/ >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;', $sp07bae2); echo '</tt></pre><br/ ><br/ ><br/ ><br/ ><br/ ><br/ >'; } else { foreach ($sp07bae2 as &$sp24bd67) { $sp24bd67 = join('<span class="m">&nbsp;</span>', explode('¿', $sp24bd67)); $sp24bd67 = join('<span class="m">&#9618;</span>', explode('¡', $sp24bd67)); $sp24bd67 = join('<span class="p">&nbsp;</span>', explode('†', $sp24bd67)); $sp24bd67 = join('<span class="p">&#9618;</span>', explode('°', $sp24bd67)); $sp24bd67 = join('<span class="s">&#9671;</span>', explode('Ñ', $sp24bd67)); $sp24bd67 = join('<span class="s">&#9670;</span>', explode('Ö', $sp24bd67)); $sp24bd67 = join('<span class="x">&#9762;</span>', explode('Å', $sp24bd67)); $sp24bd67 = join('<span class="c">&nbsp;</span>', explode('ê', $sp24bd67)); $sp24bd67 = join('<span class="c">&#9719;</span>', explode('ë', $sp24bd67)); $sp24bd67 = join('<span class="f">&nbsp;</span>', explode('à', $sp24bd67)); $sp24bd67 = join('<span class="f">&#9618;</span>', explode('â', $sp24bd67)); $sp24bd67 = join('&#9830;', explode('', $sp24bd67)); $sp24bd67 = join('&#8901;', explode(' ', $sp24bd67)); } ?>
                <style>
                    .p { background-color: yellow; }
                    .m { background-color: #00FF00; }
                    .s { background-color: #FF0000; }
                    .c { background-color: aqua; }
                    .x { background-color: pink; }
                    .f { background-color: gold; }
                </style>
                <?php  echo '<pre><tt>'; echo join('<br/ >', $sp07bae2); echo '</tt></pre>'; } } public static function serial($sp07bae2) { return gzcompress(join('
', $sp07bae2), 9); } public static function unserial($spe54fd8) { return explode('
', gzuncompress($spe54fd8)); } public static function newFrame($sp5dc7fe) { if ($sp5dc7fe < 1 || $sp5dc7fe > QRSPEC_VERSION_MAX) { return null; } if (!isset(self::$frames[$sp5dc7fe])) { $sp0f1218 = QR_CACHE_DIR . 'frame_' . $sp5dc7fe . '.dat'; if (QR_CACHEABLE) { if (file_exists($sp0f1218)) { self::$frames[$sp5dc7fe] = self::unserial(file_get_contents($sp0f1218)); } else { self::$frames[$sp5dc7fe] = self::createFrame($sp5dc7fe); file_put_contents($sp0f1218, self::serial(self::$frames[$sp5dc7fe])); } } else { self::$frames[$sp5dc7fe] = self::createFrame($sp5dc7fe); } } if (is_null(self::$frames[$sp5dc7fe])) { return null; } return self::$frames[$sp5dc7fe]; } public static function rsBlockNum($speb102b) { return $speb102b[0] + $speb102b[3]; } public static function rsBlockNum1($speb102b) { return $speb102b[0]; } public static function rsDataCodes1($speb102b) { return $speb102b[1]; } public static function rsEccCodes1($speb102b) { return $speb102b[2]; } public static function rsBlockNum2($speb102b) { return $speb102b[3]; } public static function rsDataCodes2($speb102b) { return $speb102b[4]; } public static function rsEccCodes2($speb102b) { return $speb102b[2]; } public static function rsDataLength($speb102b) { return $speb102b[0] * $speb102b[1] + $speb102b[3] * $speb102b[4]; } public static function rsEccLength($speb102b) { return ($speb102b[0] + $speb102b[3]) * $speb102b[2]; } } define('QR_IMAGE', true); class QRimage { public static function png($sp07bae2, $spc5d1c1 = false, $sp766e92 = 4, $sp0d44a8 = 4, $sp65e218 = FALSE) { $sp4ac5bf = self::image($sp07bae2, $sp766e92, $sp0d44a8); if ($spc5d1c1 === false) { Header('Content-type: image/png'); ImagePng($sp4ac5bf); } else { if ($sp65e218 === TRUE) { ImagePng($sp4ac5bf, $spc5d1c1); header('Content-type: image/png'); ImagePng($sp4ac5bf); } else { ImagePng($sp4ac5bf, $spc5d1c1); } } ImageDestroy($sp4ac5bf); } public static function jpg($sp07bae2, $spc5d1c1 = false, $sp766e92 = 8, $sp0d44a8 = 4, $sp300fec = 85) { $sp4ac5bf = self::image($sp07bae2, $sp766e92, $sp0d44a8); if ($spc5d1c1 === false) { Header('Content-type: image/jpeg'); ImageJpeg($sp4ac5bf, null, $sp300fec); } else { ImageJpeg($sp4ac5bf, $spc5d1c1, $sp300fec); } ImageDestroy($sp4ac5bf); } private static function image($sp07bae2, $sp766e92 = 4, $sp0d44a8 = 4) { $spdf7c17 = count($sp07bae2); $spdd144e = strlen($sp07bae2[0]); $sp37a6a9 = $spdd144e + 2 * $sp0d44a8; $sp51afce = $spdf7c17 + 2 * $sp0d44a8; $sp732c03 = ImageCreate($sp37a6a9, $sp51afce); $sp2f225d[0] = ImageColorAllocate($sp732c03, 255, 255, 255); $sp2f225d[1] = ImageColorAllocate($sp732c03, 0, 0, 0); imagefill($sp732c03, 0, 0, $sp2f225d[0]); for ($sp291441 = 0; $sp291441 < $spdf7c17; $sp291441++) { for ($sp112cf5 = 0; $sp112cf5 < $spdd144e; $sp112cf5++) { if ($sp07bae2[$sp291441][$sp112cf5] == '1') { ImageSetPixel($sp732c03, $sp112cf5 + $sp0d44a8, $sp291441 + $sp0d44a8, $sp2f225d[1]); } } } $sp400f56 = ImageCreate($sp37a6a9 * $sp766e92, $sp51afce * $sp766e92); ImageCopyResized($sp400f56, $sp732c03, 0, 0, 0, 0, $sp37a6a9 * $sp766e92, $sp51afce * $sp766e92, $sp37a6a9, $sp51afce); ImageDestroy($sp732c03); return $sp400f56; } } define('STRUCTURE_HEADER_BITS', 20); define('MAX_STRUCTURED_SYMBOLS', 16); class QRinputItem { public $mode; public $size; public $data; public $bstream; public function __construct($sp94ed21, $sp3d94dd, $sp29e0c7, $spdf8142 = null) { $sp88c228 = array_slice($sp29e0c7, 0, $sp3d94dd); if (count($sp88c228) < $sp3d94dd) { $sp88c228 = array_merge($sp88c228, array_fill(0, $sp3d94dd - count($sp88c228), 0)); } if (!QRinput::check($sp94ed21, $sp3d94dd, $sp88c228)) { throw new Exception('Error m:' . $sp94ed21 . ',s:' . $sp3d94dd . ',d:' . join(',', $sp88c228)); return null; } $this->mode = $sp94ed21; $this->size = $sp3d94dd; $this->data = $sp88c228; $this->bstream = $spdf8142; } public function encodeModeNum($sp5dc7fe) { try { $spdadace = (int) ($this->size / 3); $sp5e6c19 = new QRbitstream(); $sp5d0add = 1; $sp5e6c19->appendNum(4, $sp5d0add); $sp5e6c19->appendNum(QRspec::lengthIndicator(QR_MODE_NUM, $sp5dc7fe), $this->size); for ($sp747316 = 0; $sp747316 < $spdadace; $sp747316++) { $sp5d0add = (ord($this->data[$sp747316 * 3]) - ord('0')) * 100; $sp5d0add += (ord($this->data[$sp747316 * 3 + 1]) - ord('0')) * 10; $sp5d0add += ord($this->data[$sp747316 * 3 + 2]) - ord('0'); $sp5e6c19->appendNum(10, $sp5d0add); } if ($this->size - $spdadace * 3 == 1) { $sp5d0add = ord($this->data[$spdadace * 3]) - ord('0'); $sp5e6c19->appendNum(4, $sp5d0add); } else { if ($this->size - $spdadace * 3 == 2) { $sp5d0add = (ord($this->data[$spdadace * 3]) - ord('0')) * 10; $sp5d0add += ord($this->data[$spdadace * 3 + 1]) - ord('0'); $sp5e6c19->appendNum(7, $sp5d0add); } } $this->bstream = $sp5e6c19; return 0; } catch (Exception $sp1b3a33) { return -1; } } public function encodeModeAn($sp5dc7fe) { try { $spdadace = (int) ($this->size / 2); $sp5e6c19 = new QRbitstream(); $sp5e6c19->appendNum(4, 2); $sp5e6c19->appendNum(QRspec::lengthIndicator(QR_MODE_AN, $sp5dc7fe), $this->size); for ($sp747316 = 0; $sp747316 < $spdadace; $sp747316++) { $sp5d0add = (int) QRinput::lookAnTable(ord($this->data[$sp747316 * 2])) * 45; $sp5d0add += (int) QRinput::lookAnTable(ord($this->data[$sp747316 * 2 + 1])); $sp5e6c19->appendNum(11, $sp5d0add); } if ($this->size & 1) { $sp5d0add = QRinput::lookAnTable(ord($this->data[$spdadace * 2])); $sp5e6c19->appendNum(6, $sp5d0add); } $this->bstream = $sp5e6c19; return 0; } catch (Exception $sp1b3a33) { return -1; } } public function encodeMode8($sp5dc7fe) { try { $sp5e6c19 = new QRbitstream(); $sp5e6c19->appendNum(4, 4); $sp5e6c19->appendNum(QRspec::lengthIndicator(QR_MODE_8, $sp5dc7fe), $this->size); for ($sp747316 = 0; $sp747316 < $this->size; $sp747316++) { $sp5e6c19->appendNum(8, ord($this->data[$sp747316])); } $this->bstream = $sp5e6c19; return 0; } catch (Exception $sp1b3a33) { return -1; } } public function encodeModeKanji($sp5dc7fe) { try { $sp5e6c19 = new QRbitrtream(); $sp5e6c19->appendNum(4, 8); $sp5e6c19->appendNum(QRspec::lengthIndicator(QR_MODE_KANJI, $sp5dc7fe), (int) ($this->size / 2)); for ($sp747316 = 0; $sp747316 < $this->size; $sp747316 += 2) { $sp5d0add = ord($this->data[$sp747316]) << 8 | ord($this->data[$sp747316 + 1]); if ($sp5d0add <= 40956) { $sp5d0add -= 33088; } else { $sp5d0add -= 49472; } $spdf7c17 = ($sp5d0add >> 8) * 192; $sp5d0add = ($sp5d0add & 255) + $spdf7c17; $sp5e6c19->appendNum(13, $sp5d0add); } $this->bstream = $sp5e6c19; return 0; } catch (Exception $sp1b3a33) { return -1; } } public function encodeModeStructure() { try { $sp5e6c19 = new QRbitstream(); $sp5e6c19->appendNum(4, 3); $sp5e6c19->appendNum(4, ord($this->data[1]) - 1); $sp5e6c19->appendNum(4, ord($this->data[0]) - 1); $sp5e6c19->appendNum(8, ord($this->data[2])); $this->bstream = $sp5e6c19; return 0; } catch (Exception $sp1b3a33) { return -1; } } public function estimateBitStreamSizeOfEntry($sp5dc7fe) { $sp48405e = 0; if ($sp5dc7fe == 0) { $sp5dc7fe = 1; } switch ($this->mode) { case QR_MODE_NUM: $sp48405e = QRinput::estimateBitsModeNum($this->size); break; case QR_MODE_AN: $sp48405e = QRinput::estimateBitsModeAn($this->size); break; case QR_MODE_8: $sp48405e = QRinput::estimateBitsMode8($this->size); break; case QR_MODE_KANJI: $sp48405e = QRinput::estimateBitsModeKanji($this->size); break; case QR_MODE_STRUCTURE: return STRUCTURE_HEADER_BITS; default: return 0; } $sp03c4d6 = QRspec::lengthIndicator($this->mode, $sp5dc7fe); $sp4ce575 = 1 << $sp03c4d6; $spbced21 = (int) (($this->size + $sp4ce575 - 1) / $sp4ce575); $sp48405e += $spbced21 * (4 + $sp03c4d6); return $sp48405e; } public function encodeBitStream($sp5dc7fe) { try { unset($this->bstream); $spdadace = QRspec::maximumWords($this->mode, $sp5dc7fe); if ($this->size > $spdadace) { $spf10ac2 = new QRinputItem($this->mode, $spdadace, $this->data); $sp7daedc = new QRinputItem($this->mode, $this->size - $spdadace, array_slice($this->data, $spdadace)); $spf10ac2->encodeBitStream($sp5dc7fe); $sp7daedc->encodeBitStream($sp5dc7fe); $this->bstream = new QRbitstream(); $this->bstream->append($spf10ac2->bstream); $this->bstream->append($sp7daedc->bstream); unset($spf10ac2); unset($sp7daedc); } else { $sp5780b9 = 0; switch ($this->mode) { case QR_MODE_NUM: $sp5780b9 = $this->encodeModeNum($sp5dc7fe); break; case QR_MODE_AN: $sp5780b9 = $this->encodeModeAn($sp5dc7fe); break; case QR_MODE_8: $sp5780b9 = $this->encodeMode8($sp5dc7fe); break; case QR_MODE_KANJI: $sp5780b9 = $this->encodeModeKanji($sp5dc7fe); break; case QR_MODE_STRUCTURE: $sp5780b9 = $this->encodeModeStructure(); break; default: break; } if ($sp5780b9 < 0) { return -1; } } return $this->bstream->size(); } catch (Exception $sp1b3a33) { return -1; } } } class QRinput { public $items; private $version; private $level; public function __construct($sp5dc7fe = 0, $spb8f321 = QR_ECLEVEL_L) { if ($sp5dc7fe < 0 || $sp5dc7fe > QRSPEC_VERSION_MAX || $spb8f321 > QR_ECLEVEL_H) { throw new Exception('Invalid version no'); return NULL; } $this->version = $sp5dc7fe; $this->level = $spb8f321; } public function getVersion() { return $this->version; } public function setVersion($sp5dc7fe) { if ($sp5dc7fe < 0 || $sp5dc7fe > QRSPEC_VERSION_MAX) { throw new Exception('Invalid version no'); return -1; } $this->version = $sp5dc7fe; return 0; } public function getErrorCorrectionLevel() { return $this->level; } public function setErrorCorrectionLevel($spb8f321) { if ($spb8f321 > QR_ECLEVEL_H) { throw new Exception('Invalid ECLEVEL'); return -1; } $this->level = $spb8f321; return 0; } public function appendEntry(QRinputItem $sp107ffb) { $this->items[] = $sp107ffb; } public function append($sp94ed21, $sp3d94dd, $sp29e0c7) { try { $sp107ffb = new QRinputItem($sp94ed21, $sp3d94dd, $sp29e0c7); $this->items[] = $sp107ffb; return 0; } catch (Exception $sp1b3a33) { return -1; } } public function insertStructuredAppendHeader($sp3d94dd, $sp58db12, $spa7b602) { if ($sp3d94dd > MAX_STRUCTURED_SYMBOLS) { throw new Exception('insertStructuredAppendHeader wrong size'); } if ($sp58db12 <= 0 || $sp58db12 > MAX_STRUCTURED_SYMBOLS) { throw new Exception('insertStructuredAppendHeader wrong index'); } $spa3ad95 = array($sp3d94dd, $sp58db12, $spa7b602); try { $sp107ffb = new QRinputItem(QR_MODE_STRUCTURE, 3, buf); array_unshift($this->items, $sp107ffb); return 0; } catch (Exception $sp1b3a33) { return -1; } } public function calcParity() { $spa7b602 = 0; foreach ($this->items as $sp33ef93) { if ($sp33ef93->mode != QR_MODE_STRUCTURE) { for ($sp747316 = $sp33ef93->size - 1; $sp747316 >= 0; $sp747316--) { $spa7b602 ^= $sp33ef93->data[$sp747316]; } } } return $spa7b602; } public static function checkModeNum($sp3d94dd, $sp29e0c7) { for ($sp747316 = 0; $sp747316 < $sp3d94dd; $sp747316++) { if (ord($sp29e0c7[$sp747316]) < ord('0') || ord($sp29e0c7[$sp747316]) > ord('9')) { return false; } } return true; } public static function estimateBitsModeNum($sp3d94dd) { $spdd144e = (int) $sp3d94dd / 3; $sp48405e = $spdd144e * 10; switch ($sp3d94dd - $spdd144e * 3) { case 1: $sp48405e += 4; break; case 2: $sp48405e += 7; break; default: break; } return $sp48405e; } public static $anTable = array(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 36, -1, -1, -1, 37, 38, -1, -1, -1, -1, 39, 40, -1, 41, 42, 43, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 44, -1, -1, -1, -1, -1, -1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1); public static function lookAnTable($sp3c3171) { return $sp3c3171 > 127 ? -1 : self::$anTable[$sp3c3171]; } public static function checkModeAn($sp3d94dd, $sp29e0c7) { for ($sp747316 = 0; $sp747316 < $sp3d94dd; $sp747316++) { if (self::lookAnTable(ord($sp29e0c7[$sp747316])) == -1) { return false; } } return true; } public static function estimateBitsModeAn($sp3d94dd) { $spdd144e = (int) ($sp3d94dd / 2); $sp48405e = $spdd144e * 11; if ($sp3d94dd & 1) { $sp48405e += 6; } return $sp48405e; } public static function estimateBitsMode8($sp3d94dd) { return $sp3d94dd * 8; } public function estimateBitsModeKanji($sp3d94dd) { return (int) ($sp3d94dd / 2 * 13); } public static function checkModeKanji($sp3d94dd, $sp29e0c7) { if ($sp3d94dd & 1) { return false; } for ($sp747316 = 0; $sp747316 < $sp3d94dd; $sp747316 += 2) { $sp5d0add = ord($sp29e0c7[$sp747316]) << 8 | ord($sp29e0c7[$sp747316 + 1]); if ($sp5d0add < 33088 || $sp5d0add > 40956 && $sp5d0add < 57408 || $sp5d0add > 60351) { return false; } } return true; } public static function check($sp94ed21, $sp3d94dd, $sp29e0c7) { if ($sp3d94dd <= 0) { return false; } switch ($sp94ed21) { case QR_MODE_NUM: return self::checkModeNum($sp3d94dd, $sp29e0c7); break; case QR_MODE_AN: return self::checkModeAn($sp3d94dd, $sp29e0c7); break; case QR_MODE_KANJI: return self::checkModeKanji($sp3d94dd, $sp29e0c7); break; case QR_MODE_8: return true; break; case QR_MODE_STRUCTURE: return true; break; default: break; } return false; } public function estimateBitStreamSize($sp5dc7fe) { $sp48405e = 0; foreach ($this->items as $sp33ef93) { $sp48405e += $sp33ef93->estimateBitStreamSizeOfEntry($sp5dc7fe); } return $sp48405e; } public function estimateVersion() { $sp5dc7fe = 0; $spb5a7aa = 0; do { $spb5a7aa = $sp5dc7fe; $sp48405e = $this->estimateBitStreamSize($spb5a7aa); $sp5dc7fe = QRspec::getMinimumVersion((int) (($sp48405e + 7) / 8), $this->level); if ($sp5dc7fe < 0) { return -1; } } while ($sp5dc7fe > $spb5a7aa); return $sp5dc7fe; } public static function lengthOfCode($sp94ed21, $sp5dc7fe, $sp48405e) { $sp0825fa = $sp48405e - 4 - QRspec::lengthIndicator($sp94ed21, $sp5dc7fe); switch ($sp94ed21) { case QR_MODE_NUM: $sp2b039d = (int) ($sp0825fa / 10); $sp7f53ed = $sp0825fa - $sp2b039d * 10; $sp3d94dd = $sp2b039d * 3; if ($sp7f53ed >= 7) { $sp3d94dd += 2; } else { if ($sp7f53ed >= 4) { $sp3d94dd += 1; } } break; case QR_MODE_AN: $sp2b039d = (int) ($sp0825fa / 11); $sp7f53ed = $sp0825fa - $sp2b039d * 11; $sp3d94dd = $sp2b039d * 2; if ($sp7f53ed >= 6) { $sp3d94dd++; } break; case QR_MODE_8: $sp3d94dd = (int) ($sp0825fa / 8); break; case QR_MODE_KANJI: $sp3d94dd = (int) ($sp0825fa / 13 * 2); break; case QR_MODE_STRUCTURE: $sp3d94dd = (int) ($sp0825fa / 8); break; default: $sp3d94dd = 0; break; } $spbc39cf = QRspec::maximumWords($sp94ed21, $sp5dc7fe); if ($sp3d94dd < 0) { $sp3d94dd = 0; } if ($sp3d94dd > $spbc39cf) { $sp3d94dd = $spbc39cf; } return $sp3d94dd; } public function createBitStream() { $sp8b365d = 0; foreach ($this->items as $sp33ef93) { $sp48405e = $sp33ef93->encodeBitStream($this->version); if ($sp48405e < 0) { return -1; } $sp8b365d += $sp48405e; } return $sp8b365d; } public function convertData() { $spc90a29 = $this->estimateVersion(); if ($spc90a29 > $this->getVersion()) { $this->setVersion($spc90a29); } for (;;) { $sp48405e = $this->createBitStream(); if ($sp48405e < 0) { return -1; } $spc90a29 = QRspec::getMinimumVersion((int) (($sp48405e + 7) / 8), $this->level); if ($spc90a29 < 0) { throw new Exception('WRONG VERSION'); return -1; } else { if ($spc90a29 > $this->getVersion()) { $this->setVersion($spc90a29); } else { break; } } } return 0; } public function appendPaddingBit(&$spdf8142) { $sp48405e = $spdf8142->size(); $sp36f6ea = QRspec::getDataLength($this->version, $this->level); $sp3954d7 = $sp36f6ea * 8; if ($sp3954d7 == $sp48405e) { return 0; } if ($sp3954d7 - $sp48405e < 5) { return $spdf8142->appendNum($sp3954d7 - $sp48405e, 0); } $sp48405e += 4; $spdadace = (int) (($sp48405e + 7) / 8); $sp1ab1b8 = new QRbitstream(); $sp5780b9 = $sp1ab1b8->appendNum($spdadace * 8 - $sp48405e + 4, 0); if ($sp5780b9 < 0) { return $sp5780b9; } $sp71a095 = $sp36f6ea - $spdadace; if ($sp71a095 > 0) { $spdf52c7 = array(); for ($sp747316 = 0; $sp747316 < $sp71a095; $sp747316++) { $spdf52c7[$sp747316] = $sp747316 & 1 ? 17 : 236; } $sp5780b9 = $sp1ab1b8->appendBytes($sp71a095, $spdf52c7); if ($sp5780b9 < 0) { return $sp5780b9; } } $sp5780b9 = $spdf8142->append($sp1ab1b8); return $sp5780b9; } public function mergeBitStream() { if ($this->convertData() < 0) { return null; } $spdf8142 = new QRbitstream(); foreach ($this->items as $sp33ef93) { $sp5780b9 = $spdf8142->append($sp33ef93->bstream); if ($sp5780b9 < 0) { return null; } } return $spdf8142; } public function getBitStream() { $spdf8142 = $this->mergeBitStream(); if ($spdf8142 == null) { return null; } $sp5780b9 = $this->appendPaddingBit($spdf8142); if ($sp5780b9 < 0) { return null; } return $spdf8142; } public function getByteStream() { $spdf8142 = $this->getBitStream(); if ($spdf8142 == null) { return null; } return $spdf8142->toByte(); } } class QRbitstream { public $data = array(); public function size() { return count($this->data); } public function allocate($spc4f849) { $this->data = array_fill(0, $spc4f849, 0); return 0; } public static function newFromNum($sp48405e, $spbced21) { $spdf8142 = new QRbitstream(); $spdf8142->allocate($sp48405e); $sp759411 = 1 << $sp48405e - 1; for ($sp747316 = 0; $sp747316 < $sp48405e; $sp747316++) { if ($spbced21 & $sp759411) { $spdf8142->data[$sp747316] = 1; } else { $spdf8142->data[$sp747316] = 0; } $sp759411 = $sp759411 >> 1; } return $spdf8142; } public static function newFromBytes($sp3d94dd, $sp29e0c7) { $spdf8142 = new QRbitstream(); $spdf8142->allocate($sp3d94dd * 8); $sp065be2 = 0; for ($sp747316 = 0; $sp747316 < $sp3d94dd; $sp747316++) { $sp759411 = 128; for ($sp0c7cb1 = 0; $sp0c7cb1 < 8; $sp0c7cb1++) { if ($sp29e0c7[$sp747316] & $sp759411) { $spdf8142->data[$sp065be2] = 1; } else { $spdf8142->data[$sp065be2] = 0; } $sp065be2++; $sp759411 = $sp759411 >> 1; } } return $spdf8142; } public function append(QRbitstream $spc72ad7) { if (is_null($spc72ad7)) { return -1; } if ($spc72ad7->size() == 0) { return 0; } if ($this->size() == 0) { $this->data = $spc72ad7->data; return 0; } $this->data = array_values(array_merge($this->data, $spc72ad7->data)); return 0; } public function appendNum($sp48405e, $spbced21) { if ($sp48405e == 0) { return 0; } $spd38ff6 = QRbitstream::newFromNum($sp48405e, $spbced21); if (is_null($spd38ff6)) { return -1; } $sp5780b9 = $this->append($spd38ff6); unset($spd38ff6); return $sp5780b9; } public function appendBytes($sp3d94dd, $sp29e0c7) { if ($sp3d94dd == 0) { return 0; } $spd38ff6 = QRbitstream::newFromBytes($sp3d94dd, $sp29e0c7); if (is_null($spd38ff6)) { return -1; } $sp5780b9 = $this->append($spd38ff6); unset($spd38ff6); return $sp5780b9; } public function toByte() { $sp3d94dd = $this->size(); if ($sp3d94dd == 0) { return array(); } $sp29e0c7 = array_fill(0, (int) (($sp3d94dd + 7) / 8), 0); $sp34bd24 = (int) ($sp3d94dd / 8); $sp065be2 = 0; for ($sp747316 = 0; $sp747316 < $sp34bd24; $sp747316++) { $sp154f6e = 0; for ($sp0c7cb1 = 0; $sp0c7cb1 < 8; $sp0c7cb1++) { $sp154f6e = $sp154f6e << 1; $sp154f6e |= $this->data[$sp065be2]; $sp065be2++; } $sp29e0c7[$sp747316] = $sp154f6e; } if ($sp3d94dd & 7) { $sp154f6e = 0; for ($sp0c7cb1 = 0; $sp0c7cb1 < ($sp3d94dd & 7); $sp0c7cb1++) { $sp154f6e = $sp154f6e << 1; $sp154f6e |= $this->data[$sp065be2]; $sp065be2++; } $sp29e0c7[$sp34bd24] = $sp154f6e; } return $sp29e0c7; } } class QRsplit { public $dataStr = ''; public $input; public $modeHint; public function __construct($sp57de6b, $spd2b050, $sp3cd00f) { $this->dataStr = $sp57de6b; $this->input = $spd2b050; $this->modeHint = $sp3cd00f; } public static function isdigitat($spc940b6, $spf51ec7) { if ($spf51ec7 >= strlen($spc940b6)) { return false; } return ord($spc940b6[$spf51ec7]) >= ord('0') && ord($spc940b6[$spf51ec7]) <= ord('9'); } public static function isalnumat($spc940b6, $spf51ec7) { if ($spf51ec7 >= strlen($spc940b6)) { return false; } return QRinput::lookAnTable(ord($spc940b6[$spf51ec7])) >= 0; } public function identifyMode($spf51ec7) { if ($spf51ec7 >= strlen($this->dataStr)) { return QR_MODE_NUL; } $sp3c3171 = $this->dataStr[$spf51ec7]; if (self::isdigitat($this->dataStr, $spf51ec7)) { return QR_MODE_NUM; } else { if (self::isalnumat($this->dataStr, $spf51ec7)) { return QR_MODE_AN; } else { if ($this->modeHint == QR_MODE_KANJI) { if ($spf51ec7 + 1 < strlen($this->dataStr)) { $spbc28f6 = $this->dataStr[$spf51ec7 + 1]; $spb8a2eb = ord($sp3c3171) << 8 | ord($spbc28f6); if ($spb8a2eb >= 33088 && $spb8a2eb <= 40956 || $spb8a2eb >= 57408 && $spb8a2eb <= 60351) { return QR_MODE_KANJI; } } } } } return QR_MODE_8; } public function eatNum() { $sp711546 = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $sp065be2 = 0; while (self::isdigitat($this->dataStr, $sp065be2)) { $sp065be2++; } $sp6bb665 = $sp065be2; $sp94ed21 = $this->identifyMode($sp065be2); if ($sp94ed21 == QR_MODE_8) { $spefba96 = QRinput::estimateBitsModeNum($sp6bb665) + 4 + $sp711546 + QRinput::estimateBitsMode8(1) - QRinput::estimateBitsMode8($sp6bb665 + 1); if ($spefba96 > 0) { return $this->eat8(); } } if ($sp94ed21 == QR_MODE_AN) { $spefba96 = QRinput::estimateBitsModeNum($sp6bb665) + 4 + $sp711546 + QRinput::estimateBitsModeAn(1) - QRinput::estimateBitsModeAn($sp6bb665 + 1); if ($spefba96 > 0) { return $this->eatAn(); } } $sp5780b9 = $this->input->append(QR_MODE_NUM, $sp6bb665, str_split($this->dataStr)); if ($sp5780b9 < 0) { return -1; } return $sp6bb665; } public function eatAn() { $sp5ff77c = QRspec::lengthIndicator(QR_MODE_AN, $this->input->getVersion()); $sp711546 = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $sp065be2 = 0; while (self::isalnumat($this->dataStr, $sp065be2)) { if (self::isdigitat($this->dataStr, $sp065be2)) { $sp300fec = $sp065be2; while (self::isdigitat($this->dataStr, $sp300fec)) { $sp300fec++; } $spefba96 = QRinput::estimateBitsModeAn($sp065be2) + QRinput::estimateBitsModeNum($sp300fec - $sp065be2) + 4 + $sp711546 - QRinput::estimateBitsModeAn($sp300fec); if ($spefba96 < 0) { break; } else { $sp065be2 = $sp300fec; } } else { $sp065be2++; } } $sp6bb665 = $sp065be2; if (!self::isalnumat($this->dataStr, $sp065be2)) { $spefba96 = QRinput::estimateBitsModeAn($sp6bb665) + 4 + $sp5ff77c + QRinput::estimateBitsMode8(1) - QRinput::estimateBitsMode8($sp6bb665 + 1); if ($spefba96 > 0) { return $this->eat8(); } } $sp5780b9 = $this->input->append(QR_MODE_AN, $sp6bb665, str_split($this->dataStr)); if ($sp5780b9 < 0) { return -1; } return $sp6bb665; } public function eatKanji() { $sp065be2 = 0; while ($this->identifyMode($sp065be2) == QR_MODE_KANJI) { $sp065be2 += 2; } $sp5780b9 = $this->input->append(QR_MODE_KANJI, $sp065be2, str_split($this->dataStr)); if ($sp5780b9 < 0) { return -1; } return $sp6bb665; } public function eat8() { $sp5ff77c = QRspec::lengthIndicator(QR_MODE_AN, $this->input->getVersion()); $sp711546 = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $sp065be2 = 1; $spcb7e5b = strlen($this->dataStr); while ($sp065be2 < $spcb7e5b) { $sp94ed21 = $this->identifyMode($sp065be2); if ($sp94ed21 == QR_MODE_KANJI) { break; } if ($sp94ed21 == QR_MODE_NUM) { $sp300fec = $sp065be2; while (self::isdigitat($this->dataStr, $sp300fec)) { $sp300fec++; } $spefba96 = QRinput::estimateBitsMode8($sp065be2) + QRinput::estimateBitsModeNum($sp300fec - $sp065be2) + 4 + $sp711546 - QRinput::estimateBitsMode8($sp300fec); if ($spefba96 < 0) { break; } else { $sp065be2 = $sp300fec; } } else { if ($sp94ed21 == QR_MODE_AN) { $sp300fec = $sp065be2; while (self::isalnumat($this->dataStr, $sp300fec)) { $sp300fec++; } $spefba96 = QRinput::estimateBitsMode8($sp065be2) + QRinput::estimateBitsModeAn($sp300fec - $sp065be2) + 4 + $sp5ff77c - QRinput::estimateBitsMode8($sp300fec); if ($spefba96 < 0) { break; } else { $sp065be2 = $sp300fec; } } else { $sp065be2++; } } } $sp6bb665 = $sp065be2; $sp5780b9 = $this->input->append(QR_MODE_8, $sp6bb665, str_split($this->dataStr)); if ($sp5780b9 < 0) { return -1; } return $sp6bb665; } public function splitString() { while (strlen($this->dataStr) > 0) { if ($this->dataStr == '') { return 0; } $sp94ed21 = $this->identifyMode(0); switch ($sp94ed21) { case QR_MODE_NUM: $spc66ffb = $this->eatNum(); break; case QR_MODE_AN: $spc66ffb = $this->eatAn(); break; case QR_MODE_KANJI: if ($sp5be681 == QR_MODE_KANJI) { $spc66ffb = $this->eatKanji(); } else { $spc66ffb = $this->eat8(); } break; default: $spc66ffb = $this->eat8(); break; } if ($spc66ffb == 0) { return 0; } if ($spc66ffb < 0) { return -1; } $this->dataStr = substr($this->dataStr, $spc66ffb); } } public function toUpper() { $spf38886 = strlen($this->dataStr); $sp065be2 = 0; while ($sp065be2 < $spf38886) { $sp94ed21 = self::identifyMode(substr($this->dataStr, $sp065be2), $this->modeHint); if ($sp94ed21 == QR_MODE_KANJI) { $sp065be2 += 2; } else { if (ord($this->dataStr[$sp065be2]) >= ord('a') && ord($this->dataStr[$sp065be2]) <= ord('z')) { $this->dataStr[$sp065be2] = chr(ord($this->dataStr[$sp065be2]) - 32); } $sp065be2++; } } return $this->dataStr; } public static function splitStringToQRinput($sp234c2f, QRinput $spd2b050, $sp3cd00f, $sp40479d = true) { if (is_null($sp234c2f) || $sp234c2f == '\\0' || $sp234c2f == '') { throw new Exception('empty string!!!'); } $sp7cd02d = new QRsplit($sp234c2f, $spd2b050, $sp3cd00f); if (!$sp40479d) { $sp7cd02d->toUpper(); } return $sp7cd02d->splitString(); } } class QRrsItem { public $mm; public $nn; public $alpha_to = array(); public $index_of = array(); public $genpoly = array(); public $nroots; public $fcr; public $prim; public $iprim; public $pad; public $gfpoly; public function modnn($sp112cf5) { while ($sp112cf5 >= $this->nn) { $sp112cf5 -= $this->nn; $sp112cf5 = ($sp112cf5 >> $this->mm) + ($sp112cf5 & $this->nn); } return $sp112cf5; } public static function init_rs_char($sp535649, $sp7709d0, $spa41d92, $sp134b3c, $spb0ca19, $sp90a0b6) { $sp618174 = null; if ($sp535649 < 0 || $sp535649 > 8) { return $sp618174; } if ($spa41d92 < 0 || $spa41d92 >= 1 << $sp535649) { return $sp618174; } if ($sp134b3c <= 0 || $sp134b3c >= 1 << $sp535649) { return $sp618174; } if ($spb0ca19 < 0 || $spb0ca19 >= 1 << $sp535649) { return $sp618174; } if ($sp90a0b6 < 0 || $sp90a0b6 >= (1 << $sp535649) - 1 - $spb0ca19) { return $sp618174; } $sp618174 = new QRrsItem(); $sp618174->mm = $sp535649; $sp618174->nn = (1 << $sp535649) - 1; $sp618174->pad = $sp90a0b6; $sp618174->alpha_to = array_fill(0, $sp618174->nn + 1, 0); $sp618174->index_of = array_fill(0, $sp618174->nn + 1, 0); $sp102018 =& $sp618174->nn; $spba4c1a =& $sp102018; $sp618174->index_of[0] = $spba4c1a; $sp618174->alpha_to[$spba4c1a] = 0; $spf3d687 = 1; for ($sp747316 = 0; $sp747316 < $sp618174->nn; $sp747316++) { $sp618174->index_of[$spf3d687] = $sp747316; $sp618174->alpha_to[$sp747316] = $spf3d687; $spf3d687 <<= 1; if ($spf3d687 & 1 << $sp535649) { $spf3d687 ^= $sp7709d0; } $spf3d687 &= $sp618174->nn; } if ($spf3d687 != 1) { $sp618174 = NULL; return $sp618174; } $sp618174->genpoly = array_fill(0, $spb0ca19 + 1, 0); $sp618174->fcr = $spa41d92; $sp618174->prim = $sp134b3c; $sp618174->nroots = $spb0ca19; $sp618174->gfpoly = $sp7709d0; for ($spd36d78 = 1; $spd36d78 % $sp134b3c != 0; $spd36d78 += $sp618174->nn) { } $sp618174->iprim = (int) ($spd36d78 / $sp134b3c); $sp618174->genpoly[0] = 1; for ($sp747316 = 0, $sp7fa02b = $spa41d92 * $sp134b3c; $sp747316 < $spb0ca19; $sp747316++, $sp7fa02b += $sp134b3c) { $sp618174->genpoly[$sp747316 + 1] = 1; for ($sp0c7cb1 = $sp747316; $sp0c7cb1 > 0; $sp0c7cb1--) { if ($sp618174->genpoly[$sp0c7cb1] != 0) { $sp618174->genpoly[$sp0c7cb1] = $sp618174->genpoly[$sp0c7cb1 - 1] ^ $sp618174->alpha_to[$sp618174->modnn($sp618174->index_of[$sp618174->genpoly[$sp0c7cb1]] + $sp7fa02b)]; } else { $sp618174->genpoly[$sp0c7cb1] = $sp618174->genpoly[$sp0c7cb1 - 1]; } } $sp618174->genpoly[0] = $sp618174->alpha_to[$sp618174->modnn($sp618174->index_of[$sp618174->genpoly[0]] + $sp7fa02b)]; } for ($sp747316 = 0; $sp747316 <= $spb0ca19; $sp747316++) { $sp618174->genpoly[$sp747316] = $sp618174->index_of[$sp618174->genpoly[$sp747316]]; } return $sp618174; } public function encode_rs_char($sp29e0c7, &$spa7b602) { $sp50b795 =& $this->mm; $sp102018 =& $this->nn; $sp8b945f =& $this->alpha_to; $sp4c990b =& $this->index_of; $sp13c56d =& $this->genpoly; $sp84e255 =& $this->nroots; $spf1b822 =& $this->fcr; $spd1fcc6 =& $this->prim; $sp6ea488 =& $this->iprim; $spd8a4e3 =& $this->pad; $spba4c1a =& $sp102018; $spa7b602 = array_fill(0, $sp84e255, 0); for ($sp747316 = 0; $sp747316 < $sp102018 - $sp84e255 - $spd8a4e3; $sp747316++) { $sp464afe = $sp4c990b[$sp29e0c7[$sp747316] ^ $spa7b602[0]]; if ($sp464afe != $spba4c1a) { $sp464afe = $this->modnn($sp102018 - $sp13c56d[$sp84e255] + $sp464afe); for ($sp0c7cb1 = 1; $sp0c7cb1 < $sp84e255; $sp0c7cb1++) { $spa7b602[$sp0c7cb1] ^= $sp8b945f[$this->modnn($sp464afe + $sp13c56d[$sp84e255 - $sp0c7cb1])]; } } array_shift($spa7b602); if ($sp464afe != $spba4c1a) { array_push($spa7b602, $sp8b945f[$this->modnn($sp464afe + $sp13c56d[0])]); } else { array_push($spa7b602, 0); } } } } class QRrs { public static $items = array(); public static function init_rs($sp535649, $sp7709d0, $spa41d92, $sp134b3c, $spb0ca19, $sp90a0b6) { foreach (self::$items as $sp618174) { if ($sp618174->pad != $sp90a0b6) { continue; } if ($sp618174->nroots != $spb0ca19) { continue; } if ($sp618174->mm != $sp535649) { continue; } if ($sp618174->gfpoly != $sp7709d0) { continue; } if ($sp618174->fcr != $spa41d92) { continue; } if ($sp618174->prim != $sp134b3c) { continue; } return $sp618174; } $sp618174 = QRrsItem::init_rs_char($sp535649, $sp7709d0, $spa41d92, $sp134b3c, $spb0ca19, $sp90a0b6); array_unshift(self::$items, $sp618174); return $sp618174; } } define('N1', 3); define('N2', 3); define('N3', 40); define('N4', 10); class QRmask { public $runLength = array(); public function __construct() { $this->runLength = array_fill(0, QRSPEC_WIDTH_MAX + 1, 0); } public function writeFormatInformation($sp9a79fc, &$sp07bae2, $sp759411, $spb8f321) { $sp9aa711 = 0; $spe6b576 = QRspec::getFormatInfo($sp759411, $spb8f321); for ($sp747316 = 0; $sp747316 < 8; $sp747316++) { if ($spe6b576 & 1) { $sp9aa711 += 2; $sp154f6e = 133; } else { $sp154f6e = 132; } $sp07bae2[8][$sp9a79fc - 1 - $sp747316] = chr($sp154f6e); if ($sp747316 < 6) { $sp07bae2[$sp747316][8] = chr($sp154f6e); } else { $sp07bae2[$sp747316 + 1][8] = chr($sp154f6e); } $spe6b576 = $spe6b576 >> 1; } for ($sp747316 = 0; $sp747316 < 7; $sp747316++) { if ($spe6b576 & 1) { $sp9aa711 += 2; $sp154f6e = 133; } else { $sp154f6e = 132; } $sp07bae2[$sp9a79fc - 7 + $sp747316][8] = chr($sp154f6e); if ($sp747316 == 0) { $sp07bae2[8][7] = chr($sp154f6e); } else { $sp07bae2[8][6 - $sp747316] = chr($sp154f6e); } $spe6b576 = $spe6b576 >> 1; } return $sp9aa711; } public function mask0($sp112cf5, $sp291441) { return $sp112cf5 + $sp291441 & 1; } public function mask1($sp112cf5, $sp291441) { return $sp291441 & 1; } public function mask2($sp112cf5, $sp291441) { return $sp112cf5 % 3; } public function mask3($sp112cf5, $sp291441) { return ($sp112cf5 + $sp291441) % 3; } public function mask4($sp112cf5, $sp291441) { return (int) ($sp291441 / 2) + (int) ($sp112cf5 / 3) & 1; } public function mask5($sp112cf5, $sp291441) { return ($sp112cf5 * $sp291441 & 1) + $sp112cf5 * $sp291441 % 3; } public function mask6($sp112cf5, $sp291441) { return ($sp112cf5 * $sp291441 & 1) + $sp112cf5 * $sp291441 % 3 & 1; } public function mask7($sp112cf5, $sp291441) { return $sp112cf5 * $sp291441 % 3 + ($sp112cf5 + $sp291441 & 1) & 1; } private function generateMaskNo($sp478685, $sp9a79fc, $sp07bae2) { $sp37f74b = array_fill(0, $sp9a79fc, array_fill(0, $sp9a79fc, 0)); for ($sp291441 = 0; $sp291441 < $sp9a79fc; $sp291441++) { for ($sp112cf5 = 0; $sp112cf5 < $sp9a79fc; $sp112cf5++) { if (ord($sp07bae2[$sp291441][$sp112cf5]) & 128) { $sp37f74b[$sp291441][$sp112cf5] = 0; } else { $spb40efd = call_user_func(array($this, 'mask' . $sp478685), $sp112cf5, $sp291441); $sp37f74b[$sp291441][$sp112cf5] = $spb40efd == 0 ? 1 : 0; } } } return $sp37f74b; } public static function serial($spf132ab) { $sp3f199b = array(); foreach ($spf132ab as $sp8b5901) { $sp3f199b[] = join('', $sp8b5901); } return gzcompress(join('
', $sp3f199b), 9); } public static function unserial($spe54fd8) { $sp3f199b = array(); $sp20c2da = explode('
', gzuncompress($spe54fd8)); foreach ($sp20c2da as $sp8b5901) { $sp3f199b[] = str_split($sp8b5901); } return $sp3f199b; } public function makeMaskNo($sp478685, $sp9a79fc, $sp89911b, &$spbc28f6, $spb723e1 = false) { $spd38ff6 = 0; $sp37f74b = array(); $sp0f1218 = QR_CACHE_DIR . 'mask_' . $sp478685 . DIRECTORY_SEPARATOR . 'mask_' . $sp9a79fc . '_' . $sp478685 . '.dat'; if (QR_CACHEABLE) { if (file_exists($sp0f1218)) { $sp37f74b = self::unserial(file_get_contents($sp0f1218)); } else { $sp37f74b = $this->generateMaskNo($sp478685, $sp9a79fc, $sp89911b, $spbc28f6); if (!file_exists(QR_CACHE_DIR . 'mask_' . $sp478685)) { mkdir(QR_CACHE_DIR . 'mask_' . $sp478685); } file_put_contents($sp0f1218, self::serial($sp37f74b)); } } else { $sp37f74b = $this->generateMaskNo($sp478685, $sp9a79fc, $sp89911b, $spbc28f6); } if ($spb723e1) { return; } $spbc28f6 = $sp89911b; for ($sp291441 = 0; $sp291441 < $sp9a79fc; $sp291441++) { for ($sp112cf5 = 0; $sp112cf5 < $sp9a79fc; $sp112cf5++) { if ($sp37f74b[$sp291441][$sp112cf5] == 1) { $spbc28f6[$sp291441][$sp112cf5] = chr(ord($sp89911b[$sp291441][$sp112cf5]) ^ (int) $sp37f74b[$sp291441][$sp112cf5]); } $spd38ff6 += (int) (ord($spbc28f6[$sp291441][$sp112cf5]) & 1); } } return $spd38ff6; } public function makeMask($sp9a79fc, $sp07bae2, $sp478685, $spb8f321) { $sp1087a4 = array_fill(0, $sp9a79fc, str_repeat(' ', $sp9a79fc)); $this->makeMaskNo($sp478685, $sp9a79fc, $sp07bae2, $sp1087a4); $this->writeFormatInformation($sp9a79fc, $sp1087a4, $sp478685, $spb8f321); return $sp1087a4; } public function calcN1N3($spc66ffb) { $sp0c4753 = 0; for ($sp747316 = 0; $sp747316 < $spc66ffb; $sp747316++) { if ($this->runLength[$sp747316] >= 5) { $sp0c4753 += N1 + ($this->runLength[$sp747316] - 5); } if ($sp747316 & 1) { if ($sp747316 >= 3 && $sp747316 < $spc66ffb - 2 && $this->runLength[$sp747316] % 3 == 0) { $sp106bd3 = (int) ($this->runLength[$sp747316] / 3); if ($this->runLength[$sp747316 - 2] == $sp106bd3 && $this->runLength[$sp747316 - 1] == $sp106bd3 && $this->runLength[$sp747316 + 1] == $sp106bd3 && $this->runLength[$sp747316 + 2] == $sp106bd3) { if ($this->runLength[$sp747316 - 3] < 0 || $this->runLength[$sp747316 - 3] >= 4 * $sp106bd3) { $sp0c4753 += N3; } else { if ($sp747316 + 3 >= $spc66ffb || $this->runLength[$sp747316 + 3] >= 4 * $sp106bd3) { $sp0c4753 += N3; } } } } } } return $sp0c4753; } public function evaluateSymbol($sp9a79fc, $sp07bae2) { $spe4e2b7 = 0; $sp0c4753 = 0; for ($sp291441 = 0; $sp291441 < $sp9a79fc; $sp291441++) { $spe4e2b7 = 0; $this->runLength[0] = 1; $spfcb890 = $sp07bae2[$sp291441]; if ($sp291441 > 0) { $sp429b6a = $sp07bae2[$sp291441 - 1]; } for ($sp112cf5 = 0; $sp112cf5 < $sp9a79fc; $sp112cf5++) { if ($sp112cf5 > 0 && $sp291441 > 0) { $spfe74e2 = ord($spfcb890[$sp112cf5]) & ord($spfcb890[$sp112cf5 - 1]) & ord($sp429b6a[$sp112cf5]) & ord($sp429b6a[$sp112cf5 - 1]); $sp24cdc4 = ord($spfcb890[$sp112cf5]) | ord($spfcb890[$sp112cf5 - 1]) | ord($sp429b6a[$sp112cf5]) | ord($sp429b6a[$sp112cf5 - 1]); if (($spfe74e2 | $sp24cdc4 ^ 1) & 1) { $sp0c4753 += N2; } } if ($sp112cf5 == 0 && ord($spfcb890[$sp112cf5]) & 1) { $this->runLength[0] = -1; $spe4e2b7 = 1; $this->runLength[$spe4e2b7] = 1; } else { if ($sp112cf5 > 0) { if ((ord($spfcb890[$sp112cf5]) ^ ord($spfcb890[$sp112cf5 - 1])) & 1) { $spe4e2b7++; $this->runLength[$spe4e2b7] = 1; } else { $this->runLength[$spe4e2b7]++; } } } } $sp0c4753 += $this->calcN1N3($spe4e2b7 + 1); } for ($sp112cf5 = 0; $sp112cf5 < $sp9a79fc; $sp112cf5++) { $spe4e2b7 = 0; $this->runLength[0] = 1; for ($sp291441 = 0; $sp291441 < $sp9a79fc; $sp291441++) { if ($sp291441 == 0 && ord($sp07bae2[$sp291441][$sp112cf5]) & 1) { $this->runLength[0] = -1; $spe4e2b7 = 1; $this->runLength[$spe4e2b7] = 1; } else { if ($sp291441 > 0) { if ((ord($sp07bae2[$sp291441][$sp112cf5]) ^ ord($sp07bae2[$sp291441 - 1][$sp112cf5])) & 1) { $spe4e2b7++; $this->runLength[$spe4e2b7] = 1; } else { $this->runLength[$spe4e2b7]++; } } } } $sp0c4753 += $this->calcN1N3($spe4e2b7 + 1); } return $sp0c4753; } public function mask($sp9a79fc, $sp07bae2, $spb8f321) { $spa47ecc = PHP_INT_MAX; $sp9e4417 = 0; $spcfe668 = array(); $sp9afadf = array(0, 1, 2, 3, 4, 5, 6, 7); if (QR_FIND_FROM_RANDOM !== false) { $sp566f15 = 8 - QR_FIND_FROM_RANDOM % 9; for ($sp747316 = 0; $sp747316 < $sp566f15; $sp747316++) { $sp3fd544 = rand(0, count($sp9afadf) - 1); unset($sp9afadf[$sp3fd544]); $sp9afadf = array_values($sp9afadf); } } $spcfe668 = $sp07bae2; foreach ($sp9afadf as $sp747316) { $sp759411 = array_fill(0, $sp9a79fc, str_repeat(' ', $sp9a79fc)); $sp0c4753 = 0; $sp9aa711 = 0; $sp9aa711 = $this->makeMaskNo($sp747316, $sp9a79fc, $sp07bae2, $sp759411); $sp9aa711 += $this->writeFormatInformation($sp9a79fc, $sp759411, $sp747316, $spb8f321); $sp9aa711 = (int) (100 * $sp9aa711 / ($sp9a79fc * $sp9a79fc)); $sp0c4753 = (int) ((int) (abs($sp9aa711 - 50) / 5) * N4); $sp0c4753 += $this->evaluateSymbol($sp9a79fc, $sp759411); if ($sp0c4753 < $spa47ecc) { $spa47ecc = $sp0c4753; $spcfe668 = $sp759411; $sp9e4417 = $sp747316; } } return $spcfe668; } } class QRrsblock { public $dataLength; public $data = array(); public $eccLength; public $ecc = array(); public function __construct($spb344ed, $sp29e0c7, $sp1f1660, &$sp57a5ab, QRrsItem $sp618174) { $sp618174->encode_rs_char($sp29e0c7, $sp57a5ab); $this->dataLength = $spb344ed; $this->data = $sp29e0c7; $this->eccLength = $sp1f1660; $this->ecc = $sp57a5ab; } } class QRrawcode { public $version; public $datacode = array(); public $ecccode = array(); public $blocks; public $rsblocks = array(); public $count; public $dataLength; public $eccLength; public $b1; public function __construct(QRinput $spd2b050) { $speb102b = array(0, 0, 0, 0, 0); $this->datacode = $spd2b050->getByteStream(); if (is_null($this->datacode)) { throw new Exception('null imput string'); } QRspec::getEccSpec($spd2b050->getVersion(), $spd2b050->getErrorCorrectionLevel(), $speb102b); $this->version = $spd2b050->getVersion(); $this->b1 = QRspec::rsBlockNum1($speb102b); $this->dataLength = QRspec::rsDataLength($speb102b); $this->eccLength = QRspec::rsEccLength($speb102b); $this->ecccode = array_fill(0, $this->eccLength, 0); $this->blocks = QRspec::rsBlockNum($speb102b); $sp5780b9 = $this->init($speb102b); if ($sp5780b9 < 0) { throw new Exception('block alloc error'); return null; } $this->count = 0; } public function init(array $speb102b) { $spb344ed = QRspec::rsDataCodes1($speb102b); $sp1f1660 = QRspec::rsEccCodes1($speb102b); $sp618174 = QRrs::init_rs(8, 285, 0, 1, $sp1f1660, 255 - $spb344ed - $sp1f1660); $sp34490e = 0; $spa886fe = 0; $sp692114 = 0; for ($sp747316 = 0; $sp747316 < QRspec::rsBlockNum1($speb102b); $sp747316++) { $sp57a5ab = array_slice($this->ecccode, $sp692114); $this->rsblocks[$sp34490e] = new QRrsblock($spb344ed, array_slice($this->datacode, $spa886fe), $sp1f1660, $sp57a5ab, $sp618174); $this->ecccode = array_merge(array_slice($this->ecccode, 0, $sp692114), $sp57a5ab); $spa886fe += $spb344ed; $sp692114 += $sp1f1660; $sp34490e++; } if (QRspec::rsBlockNum2($speb102b) == 0) { return 0; } $spb344ed = QRspec::rsDataCodes2($speb102b); $sp1f1660 = QRspec::rsEccCodes2($speb102b); $sp618174 = QRrs::init_rs(8, 285, 0, 1, $sp1f1660, 255 - $spb344ed - $sp1f1660); if ($sp618174 == NULL) { return -1; } for ($sp747316 = 0; $sp747316 < QRspec::rsBlockNum2($speb102b); $sp747316++) { $sp57a5ab = array_slice($this->ecccode, $sp692114); $this->rsblocks[$sp34490e] = new QRrsblock($spb344ed, array_slice($this->datacode, $spa886fe), $sp1f1660, $sp57a5ab, $sp618174); $this->ecccode = array_merge(array_slice($this->ecccode, 0, $sp692114), $sp57a5ab); $spa886fe += $spb344ed; $sp692114 += $sp1f1660; $sp34490e++; } return 0; } public function getCode() { $sp5780b9; if ($this->count < $this->dataLength) { $sp185f1a = $this->count % $this->blocks; $sp2f225d = $this->count / $this->blocks; if ($sp2f225d >= $this->rsblocks[0]->dataLength) { $sp185f1a += $this->b1; } $sp5780b9 = $this->rsblocks[$sp185f1a]->data[$sp2f225d]; } else { if ($this->count < $this->dataLength + $this->eccLength) { $sp185f1a = ($this->count - $this->dataLength) % $this->blocks; $sp2f225d = ($this->count - $this->dataLength) / $this->blocks; $sp5780b9 = $this->rsblocks[$sp185f1a]->ecc[$sp2f225d]; } else { return 0; } } $this->count++; return $sp5780b9; } } class QRcode { public $version; public $width; public $data; public function encodeMask(QRinput $spd2b050, $sp759411) { if ($spd2b050->getVersion() < 0 || $spd2b050->getVersion() > QRSPEC_VERSION_MAX) { throw new Exception('wrong version'); } if ($spd2b050->getErrorCorrectionLevel() > QR_ECLEVEL_H) { throw new Exception('wrong level'); } $spca3d7e = new QRrawcode($spd2b050); QRtools::markTime('after_raw'); $sp5dc7fe = $spca3d7e->version; $sp9a79fc = QRspec::getWidth($sp5dc7fe); $sp07bae2 = QRspec::newFrame($sp5dc7fe); $sp5ae74f = new FrameFiller($sp9a79fc, $sp07bae2); if (is_null($sp5ae74f)) { return NULL; } for ($sp747316 = 0; $sp747316 < $spca3d7e->dataLength + $spca3d7e->eccLength; $sp747316++) { $spe54fd8 = $spca3d7e->getCode(); $spd2bd22 = 128; for ($sp0c7cb1 = 0; $sp0c7cb1 < 8; $sp0c7cb1++) { $spb5f766 = $sp5ae74f->next(); $sp5ae74f->setFrameAt($spb5f766, 2 | ($spd2bd22 & $spe54fd8) != 0); $spd2bd22 = $spd2bd22 >> 1; } } QRtools::markTime('after_filler'); unset($spca3d7e); $sp0c7cb1 = QRspec::getRemainder($sp5dc7fe); for ($sp747316 = 0; $sp747316 < $sp0c7cb1; $sp747316++) { $spb5f766 = $sp5ae74f->next(); $sp5ae74f->setFrameAt($spb5f766, 2); } $sp07bae2 = $sp5ae74f->frame; unset($sp5ae74f); $sp17d78e = new QRmask(); if ($sp759411 < 0) { if (QR_FIND_BEST_MASK) { $sp1087a4 = $sp17d78e->mask($sp9a79fc, $sp07bae2, $spd2b050->getErrorCorrectionLevel()); } else { $sp1087a4 = $sp17d78e->makeMask($sp9a79fc, $sp07bae2, intval(QR_DEFAULT_MASK) % 8, $spd2b050->getErrorCorrectionLevel()); } } else { $sp1087a4 = $sp17d78e->makeMask($sp9a79fc, $sp07bae2, $sp759411, $spd2b050->getErrorCorrectionLevel()); } if ($sp1087a4 == NULL) { return NULL; } QRtools::markTime('after_mask'); $this->version = $sp5dc7fe; $this->width = $sp9a79fc; $this->data = $sp1087a4; return $this; } public function encodeInput(QRinput $spd2b050) { return $this->encodeMask($spd2b050, -1); } public function encodeString8bit($sp234c2f, $sp5dc7fe, $spb8f321) { if (string == NULL) { throw new Exception('empty string!'); return NULL; } $spd2b050 = new QRinput($sp5dc7fe, $spb8f321); if ($spd2b050 == NULL) { return NULL; } $sp5780b9 = $spd2b050->append($spd2b050, QR_MODE_8, strlen($sp234c2f), str_split($sp234c2f)); if ($sp5780b9 < 0) { unset($spd2b050); return NULL; } return $this->encodeInput($spd2b050); } public function encodeString($sp234c2f, $sp5dc7fe, $spb8f321, $sp5be681, $sp40479d) { if ($sp5be681 != QR_MODE_8 && $sp5be681 != QR_MODE_KANJI) { throw new Exception('bad hint'); return NULL; } $spd2b050 = new QRinput($sp5dc7fe, $spb8f321); if ($spd2b050 == NULL) { return NULL; } $sp5780b9 = QRsplit::splitStringToQRinput($sp234c2f, $spd2b050, $sp5be681, $sp40479d); if ($sp5780b9 < 0) { return NULL; } return $this->encodeInput($spd2b050); } public static function png($spfe3b14, $spbbdd0f = false, $spb8f321 = QR_ECLEVEL_L, $sp3d94dd = 3, $spb18064 = 4, $sp65e218 = false) { $sp913153 = QRencode::factory($spb8f321, $sp3d94dd, $spb18064); return $sp913153->encodePNG($spfe3b14, $spbbdd0f, $sp65e218 = false); } public static function text($spfe3b14, $spbbdd0f = false, $spb8f321 = QR_ECLEVEL_L, $sp3d94dd = 3, $spb18064 = 4) { $sp913153 = QRencode::factory($spb8f321, $sp3d94dd, $spb18064); return $sp913153->encode($spfe3b14, $spbbdd0f); } public static function raw($spfe3b14, $spbbdd0f = false, $spb8f321 = QR_ECLEVEL_L, $sp3d94dd = 3, $spb18064 = 4) { $sp913153 = QRencode::factory($spb8f321, $sp3d94dd, $spb18064); return $sp913153->encodeRAW($spfe3b14, $spbbdd0f); } } class FrameFiller { public $width; public $frame; public $x; public $y; public $dir; public $bit; public function __construct($sp9a79fc, &$sp07bae2) { $this->width = $sp9a79fc; $this->frame = $sp07bae2; $this->x = $sp9a79fc - 1; $this->y = $sp9a79fc - 1; $this->dir = -1; $this->bit = -1; } public function setFrameAt($sp16090c, $sp5d0add) { $this->frame[$sp16090c['y']][$sp16090c['x']] = chr($sp5d0add); } public function getFrameAt($sp16090c) { return ord($this->frame[$sp16090c['y']][$sp16090c['x']]); } public function next() { do { if ($this->bit == -1) { $this->bit = 0; return array('x' => $this->x, 'y' => $this->y); } $sp112cf5 = $this->x; $sp291441 = $this->y; $spdd144e = $this->width; if ($this->bit == 0) { $sp112cf5--; $this->bit++; } else { $sp112cf5++; $sp291441 += $this->dir; $this->bit--; } if ($this->dir < 0) { if ($sp291441 < 0) { $sp291441 = 0; $sp112cf5 -= 2; $this->dir = 1; if ($sp112cf5 == 6) { $sp112cf5--; $sp291441 = 9; } } } else { if ($sp291441 == $spdd144e) { $sp291441 = $spdd144e - 1; $sp112cf5 -= 2; $this->dir = -1; if ($sp112cf5 == 6) { $sp112cf5--; $sp291441 -= 8; } } } if ($sp112cf5 < 0 || $sp291441 < 0) { return null; } $this->x = $sp112cf5; $this->y = $sp291441; } while (ord($this->frame[$sp291441][$sp112cf5]) & 128); return array('x' => $sp112cf5, 'y' => $sp291441); } } class QRencode { public $casesensitive = true; public $eightbit = false; public $version = 0; public $size = 3; public $margin = 4; public $structured = 0; public $level = QR_ECLEVEL_L; public $hint = QR_MODE_8; public static function factory($spb8f321 = QR_ECLEVEL_L, $sp3d94dd = 3, $spb18064 = 4) { $sp913153 = new QRencode(); $sp913153->size = $sp3d94dd; $sp913153->margin = $spb18064; switch ($spb8f321 . '') { case '0': case '1': case '2': case '3': $sp913153->level = $spb8f321; break; case 'l': case 'L': $sp913153->level = QR_ECLEVEL_L; break; case 'm': case 'M': $sp913153->level = QR_ECLEVEL_M; break; case 'q': case 'Q': $sp913153->level = QR_ECLEVEL_Q; break; case 'h': case 'H': $sp913153->level = QR_ECLEVEL_H; break; } return $sp913153; } public function encodeRAW($sp2c32bc, $spbbdd0f = false) { $spe54fd8 = new QRcode(); if ($this->eightbit) { $spe54fd8->encodeString8bit($sp2c32bc, $this->version, $this->level); } else { $spe54fd8->encodeString($sp2c32bc, $this->version, $this->level, $this->hint, $this->casesensitive); } return $spe54fd8->data; } public function encode($sp2c32bc, $spbbdd0f = false) { $spe54fd8 = new QRcode(); if ($this->eightbit) { $spe54fd8->encodeString8bit($sp2c32bc, $this->version, $this->level); } else { $spe54fd8->encodeString($sp2c32bc, $this->version, $this->level, $this->hint, $this->casesensitive); } QRtools::markTime('after_encode'); if ($spbbdd0f !== false) { file_put_contents($spbbdd0f, join('
', QRtools::binarize($spe54fd8->data))); } else { return QRtools::binarize($spe54fd8->data); } } public function encodePNG($sp2c32bc, $spbbdd0f = false, $sp65e218 = false) { try { ob_start(); $sp28650d = $this->encode($sp2c32bc); $sp173961 = ob_get_contents(); ob_end_clean(); if ($sp173961 != '') { QRtools::log($spbbdd0f, $sp173961); } $spf92ca3 = (int) (QR_PNG_MAXIMUM_SIZE / (count($sp28650d) + 2 * $this->margin)); QRimage::png($sp28650d, $spbbdd0f, min(max(1, $this->size), $spf92ca3), $this->margin, $sp65e218); } catch (Exception $sp1b3a33) { QRtools::log($spbbdd0f, $sp1b3a33->getMessage()); } } }