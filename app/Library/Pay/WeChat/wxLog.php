<?php
interface ILogHandler { public function write($sp3792af); } class CLogFileHandler implements ILogHandler { private $handle = null; public function __construct($spbef20a = '') { $this->handle = @fopen($spbef20a, 'a'); } public function write($sp3792af) { @fwrite($this->handle, $sp3792af, 4096); } public function __destruct() { @fclose($this->handle); } } class WxLog { private $handler = null; private $level = 15; private static $instance = null; private function __construct() { } private function __clone() { } public static function Init($sp30c90f = null, $spde70db = 15) { if (!self::$instance instanceof self) { self::$instance = new self(); self::$instance->__setHandle($sp30c90f); self::$instance->__setLevel($spde70db); } return self::$instance; } private function __setHandle($sp30c90f) { $this->handler = $sp30c90f; } private function __setLevel($spde70db) { $this->level = $spde70db; } public static function DEBUG($sp3792af) { } public static function WARN($sp3792af) { self::$instance->write(4, $sp3792af); } public static function ERROR($sp3792af) { $sp148901 = debug_backtrace(); $sp193937 = '['; foreach ($sp148901 as $spa8a71b => $sp3172ba) { if (array_key_exists('file', $sp3172ba)) { $sp193937 .= ',file:' . $sp3172ba['file']; } if (array_key_exists('line', $sp3172ba)) { $sp193937 .= ',line:' . $sp3172ba['line']; } if (array_key_exists('function', $sp3172ba)) { $sp193937 .= ',function:' . $sp3172ba['function']; } } $sp193937 .= ']'; self::$instance->write(8, $sp193937 . $sp3792af); } public static function INFO($sp3792af) { self::$instance->write(2, $sp3792af); } private function getLevelStr($spde70db) { switch ($spde70db) { case 1: return 'debug'; break; case 2: return 'info'; break; case 4: return 'warn'; break; case 8: return 'error'; break; default: } } protected function write($spde70db, $sp3792af) { if (($spde70db & $this->level) == $spde70db) { $sp3792af = '[' . date('Y-m-d H:i:s') . '][' . $this->getLevelStr($spde70db) . '] ' . $sp3792af . '
'; $this->handler->write($sp3792af); } } } $sp96c2fa = new CLogFileHandler('logs/' . date('Y-m-d') . '.log'); WxLog::Init($sp96c2fa, 15);