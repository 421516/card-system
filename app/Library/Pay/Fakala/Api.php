<?php
namespace App\Library\Pay\Fakala; use App\Library\Pay\ApiInterface; class Api implements ApiInterface { private $url_notify = ''; private $url_return = ''; private $pay_id; public function __construct($sp3a2be3) { $this->url_notify = SYS_URL_API . '/pay/notify/' . $sp3a2be3; $this->url_return = SYS_URL . '/pay/return/' . $sp3a2be3; $this->pay_id = $sp3a2be3; } function goPay($sp45b2a0, $spd184e1, $sp873da9, $sp33eb4d, $sp521b2c) { if (!isset($sp45b2a0['gateway'])) { throw new \Exception('请填写gateway'); } if (!isset($sp45b2a0['api_id'])) { throw new \Exception('请填写api_id'); } if (!isset($sp45b2a0['api_key'])) { throw new \Exception('请填写api_key'); } include_once 'sdk.php'; $spd7c0e9 = new \fakala($sp45b2a0['gateway'], $sp45b2a0['api_id'], $sp45b2a0['api_key']); $sp1cc6bf = strtolower($sp45b2a0['payway']); $spd7c0e9->goPay($sp1cc6bf, $spd184e1, 0, $sp521b2c, '', $this->url_return, $this->url_notify); } function verify($sp45b2a0, $spf85c0e) { $sp5c8ce2 = isset($sp45b2a0['isNotify']) && $sp45b2a0['isNotify']; include_once 'sdk.php'; $spd7c0e9 = new \fakala($sp45b2a0['gateway'], $sp45b2a0['api_id'], $sp45b2a0['api_key']); if ($sp5c8ce2) { $spcc4042 = $spd7c0e9->notify_verify(); } else { $spcc4042 = $spd7c0e9->return_verify(); } if ($spcc4042) { $spd184e1 = $_REQUEST['out_trade_no']; $sp07a665 = $_REQUEST['total_fee']; $sp19d20b = $_REQUEST['order_no']; $spf85c0e($spd184e1, $sp07a665, $sp19d20b); } return $spcc4042; } }