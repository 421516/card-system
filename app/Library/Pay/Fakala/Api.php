<?php
namespace App\Library\Pay\Fakala; use App\Library\Pay\ApiInterface; class Api implements ApiInterface { private $url_notify = ''; private $url_return = ''; private $pay_id; public function __construct($sp403bd7) { $this->url_notify = SYS_URL_API . '/pay/notify/' . $sp403bd7; $this->url_return = SYS_URL . '/pay/return/' . $sp403bd7; $this->pay_id = $sp403bd7; } function goPay($sp4d5cc2, $sp2714cc, $spc644e5, $sp5b5e88, $sp9d9f48) { if (!isset($sp4d5cc2['gateway'])) { throw new \Exception('请填写gateway'); } if (!isset($sp4d5cc2['api_id'])) { throw new \Exception('请填写api_id'); } if (!isset($sp4d5cc2['api_key'])) { throw new \Exception('请填写api_key'); } include_once 'sdk.php'; $sp079fb4 = new \fakala($sp4d5cc2['gateway'], $sp4d5cc2['api_id'], $sp4d5cc2['api_key']); $sp486342 = strtolower($sp4d5cc2['payway']); $sp079fb4->goPay($sp486342, $sp2714cc, 0, $sp9d9f48, '', $this->url_return, $this->url_notify); } function verify($sp4d5cc2, $spae1cf8) { $sp5c532f = isset($sp4d5cc2['isNotify']) && $sp4d5cc2['isNotify']; include_once 'sdk.php'; $sp079fb4 = new \fakala($sp4d5cc2['gateway'], $sp4d5cc2['api_id'], $sp4d5cc2['api_key']); if ($sp5c532f) { $spc4a98e = $sp079fb4->notify_verify(); } else { $spc4a98e = $sp079fb4->return_verify(); } if ($spc4a98e) { $sp2714cc = $_REQUEST['out_trade_no']; $spe1a1d8 = $_REQUEST['total_fee']; $sp88d61c = $_REQUEST['order_no']; $spae1cf8($sp2714cc, $spe1a1d8, $sp88d61c); } return $spc4a98e; } }