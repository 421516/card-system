<?php
include 'AlipayMobilePublicMultiMediaExecute.php'; class AlipayMobilePublicMultiMediaClient { private $DEFAULT_CHARSET = 'UTF-8'; private $METHOD_POST = 'POST'; private $METHOD_GET = 'GET'; private $SIGN = 'sign'; private $timeout = 10; private $serverUrl; private $appId; private $privateKey; private $prodCode; private $format = 'json'; private $sign_type = 'RSA'; private $charset; private $apiVersion = '1.0'; private $apiMethodName = 'alipay.mobile.public.multimedia.download'; private $media_id = 'L21pZnMvVDFQV3hYWGJKWFhYYUNucHJYP3Q9YW13ZiZ4c2lnPTU0MzRhYjg1ZTZjNWJmZTMxZGJiNjIzNDdjMzFkNzkw575'; private $connectTimeout = 3000; private $readTimeout = 15000; function __construct($sp3b79d8 = '', $sp38cd45 = '', $sp8dd71d = '', $spbbf2b0 = '', $spa6120e = 'GBK') { $this->serverUrl = $sp3b79d8; $this->appId = $sp38cd45; $this->privateKey = $sp8dd71d; $this->format = $spbbf2b0; $this->charset = $spa6120e; } public function getContents() { $sp500602 = array('app_id' => $this->appId, 'method' => $this->METHOD_POST, 'sign_type' => $this->sign_type, 'version' => $this->apiVersion, 'timestamp' => date('Y-m-d H:i:s'), 'biz_content' => '{"mediaId":"' . $this->media_id . '"}', 'charset' => $this->charset); $spd1c812 = $this->buildGetUrl($sp500602); $sp1bb3d0 = $spd1c812; $spb70507 = curl_init(); curl_setopt($spb70507, CURLOPT_URL, $this->serverUrl); curl_setopt($spb70507, CURLOPT_HEADER, TRUE); curl_setopt($spb70507, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spb70507, CURLOPT_TIMEOUT, $this->timeout); if ($this->METHOD_POST == 'POST') { curl_setopt($spb70507, CURLOPT_POST, 1); curl_setopt($spb70507, CURLOPT_POSTFIELDS, $sp1bb3d0); } $sp315fc3 = curl_exec($spb70507); $speb84ec = curl_getinfo($spb70507, CURLINFO_HTTP_CODE); curl_close($spb70507); echo $sp315fc3; $sp500602 = explode('

', $sp315fc3, 2); $sp6e5e49 = $sp500602[0]; if ($speb84ec == '200') { $sp33eb4d = $sp500602[1]; } else { $sp33eb4d = ''; } return $this->execute($sp6e5e49, $sp33eb4d, $speb84ec); } public function execute($sp6e5e49 = '', $sp33eb4d = '', $speb84ec = '') { $spd5f3a0 = new AlipayMobilePublicMultiMediaExecute($sp6e5e49, $sp33eb4d, $speb84ec); return $spd5f3a0; } public function buildGetUrl($sp3eff46 = array()) { if (!is_array($sp3eff46)) { } $sp38c5ae = $this->buildQuery($sp3eff46); $spf13efe = ''; $sp197243 = 64; $sp85bed6 = $this->privateKey; $sp7aa958 = array(); if (!stripos($sp85bed6, '
')) { $sp836a84 = 0; while ($sp6a389f = substr($sp85bed6, $sp836a84 * $sp197243, $sp197243)) { $sp7aa958[] = $sp6a389f; $sp836a84++; } } else { } $sp85bed6 = '-----BEGIN RSA PRIVATE KEY-----
' . implode('
', $sp7aa958); $sp85bed6 = $sp85bed6 . '
-----END RSA PRIVATE KEY-----'; $sp44aad9 = openssl_pkey_get_private($sp85bed6, $spf13efe); $sp16bfba = ''; if ('RSA2' == $this->sign_type) { openssl_sign($sp38c5ae, $sp16bfba, $sp44aad9, OPENSSL_ALGO_SHA256); } else { openssl_sign($sp38c5ae, $sp16bfba, $sp44aad9, OPENSSL_ALGO_SHA1); } openssl_free_key($sp44aad9); $sp16bfba = base64_encode($sp16bfba); $sp16bfba = urlencode($sp16bfba); $sp342c69 = $sp38c5ae . '&' . $this->SIGN . '=' . $sp16bfba; return $sp342c69; } public function buildQuery($sp3eff46) { if (!$sp3eff46) { return null; } ksort($sp3eff46); $spf44b7f = array(); foreach ($sp3eff46 as $spa8a71b => $spffe9f9) { $spf44b7f[] = $spa8a71b . '=' . $spffe9f9; } $sp38c5ae = implode('&', $spf44b7f); return $sp38c5ae; } }