<?php
include 'AlipayMobilePublicMultiMediaExecute.php'; class AlipayMobilePublicMultiMediaClient { private $DEFAULT_CHARSET = 'UTF-8'; private $METHOD_POST = 'POST'; private $METHOD_GET = 'GET'; private $SIGN = 'sign'; private $timeout = 10; private $serverUrl; private $appId; private $privateKey; private $prodCode; private $format = 'json'; private $sign_type = 'RSA'; private $charset; private $apiVersion = '1.0'; private $apiMethodName = 'alipay.mobile.public.multimedia.download'; private $media_id = 'L21pZnMvVDFQV3hYWGJKWFhYYUNucHJYP3Q9YW13ZiZ4c2lnPTU0MzRhYjg1ZTZjNWJmZTMxZGJiNjIzNDdjMzFkNzkw575'; private $connectTimeout = 3000; private $readTimeout = 15000; function __construct($sp7d4c7d = '', $sp9bfe13 = '', $sp05badf = '', $sp76cfc0 = '', $sped661f = 'GBK') { $this->serverUrl = $sp7d4c7d; $this->appId = $sp9bfe13; $this->privateKey = $sp05badf; $this->format = $sp76cfc0; $this->charset = $sped661f; } public function getContents() { $sp5750de = array('app_id' => $this->appId, 'method' => $this->METHOD_POST, 'sign_type' => $this->sign_type, 'version' => $this->apiVersion, 'timestamp' => date('Y-m-d H:i:s'), 'biz_content' => '{"mediaId":"' . $this->media_id . '"}', 'charset' => $this->charset); $sp7e5da4 = $this->buildGetUrl($sp5750de); $spe84b71 = $sp7e5da4; $speafaa9 = curl_init(); curl_setopt($speafaa9, CURLOPT_URL, $this->serverUrl); curl_setopt($speafaa9, CURLOPT_HEADER, TRUE); curl_setopt($speafaa9, CURLOPT_RETURNTRANSFER, 1); curl_setopt($speafaa9, CURLOPT_TIMEOUT, $this->timeout); if ($this->METHOD_POST == 'POST') { curl_setopt($speafaa9, CURLOPT_POST, 1); curl_setopt($speafaa9, CURLOPT_POSTFIELDS, $spe84b71); } $spea3669 = curl_exec($speafaa9); $spb2d9a6 = curl_getinfo($speafaa9, CURLINFO_HTTP_CODE); curl_close($speafaa9); echo $spea3669; $sp5750de = explode('

', $spea3669, 2); $spf15143 = $sp5750de[0]; if ($spb2d9a6 == '200') { $sp1d246b = $sp5750de[1]; } else { $sp1d246b = ''; } return $this->execute($spf15143, $sp1d246b, $spb2d9a6); } public function execute($spf15143 = '', $sp1d246b = '', $spb2d9a6 = '') { $spf3291b = new AlipayMobilePublicMultiMediaExecute($spf15143, $sp1d246b, $spb2d9a6); return $spf3291b; } public function buildGetUrl($spedc15a = array()) { if (!is_array($spedc15a)) { } $sp94131d = $this->buildQuery($spedc15a); $sp099a05 = ''; $sp961385 = 64; $sp0e201b = $this->privateKey; $sp764d7a = array(); if (!stripos($sp0e201b, '
')) { $spcecaa9 = 0; while ($spb68938 = substr($sp0e201b, $spcecaa9 * $sp961385, $sp961385)) { $sp764d7a[] = $spb68938; $spcecaa9++; } } else { } $sp0e201b = '-----BEGIN RSA PRIVATE KEY-----
' . implode('
', $sp764d7a); $sp0e201b = $sp0e201b . '
-----END RSA PRIVATE KEY-----'; $spebee50 = openssl_pkey_get_private($sp0e201b, $sp099a05); $sp953075 = ''; if ('RSA2' == $this->sign_type) { openssl_sign($sp94131d, $sp953075, $spebee50, OPENSSL_ALGO_SHA256); } else { openssl_sign($sp94131d, $sp953075, $spebee50, OPENSSL_ALGO_SHA1); } openssl_free_key($spebee50); $sp953075 = base64_encode($sp953075); $sp953075 = urlencode($sp953075); $sp13047e = $sp94131d . '&' . $this->SIGN . '=' . $sp953075; return $sp13047e; } public function buildQuery($spedc15a) { if (!$spedc15a) { return null; } ksort($spedc15a); $sp31ee10 = array(); foreach ($spedc15a as $sp63ae76 => $sp308e09) { $sp31ee10[] = $sp63ae76 . '=' . $sp308e09; } $sp94131d = implode('&', $sp31ee10); return $sp94131d; } }