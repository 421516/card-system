<?php
include 'AlipayMobilePublicMultiMediaExecute.php'; class AlipayMobilePublicMultiMediaClient { private $DEFAULT_CHARSET = 'UTF-8'; private $METHOD_POST = 'POST'; private $METHOD_GET = 'GET'; private $SIGN = 'sign'; private $timeout = 10; private $serverUrl; private $appId; private $privateKey; private $prodCode; private $format = 'json'; private $sign_type = 'RSA'; private $charset; private $apiVersion = '1.0'; private $apiMethodName = 'alipay.mobile.public.multimedia.download'; private $media_id = 'L21pZnMvVDFQV3hYWGJKWFhYYUNucHJYP3Q9YW13ZiZ4c2lnPTU0MzRhYjg1ZTZjNWJmZTMxZGJiNjIzNDdjMzFkNzkw575'; private $connectTimeout = 3000; private $readTimeout = 15000; function __construct($spcc4924 = '', $sp99d130 = '', $sp38aba0 = '', $spe9e29b = '', $spd588b5 = 'GBK') { $this->serverUrl = $spcc4924; $this->appId = $sp99d130; $this->privateKey = $sp38aba0; $this->format = $spe9e29b; $this->charset = $spd588b5; } public function getContents() { $spdbffc2 = array('app_id' => $this->appId, 'method' => $this->METHOD_POST, 'sign_type' => $this->sign_type, 'version' => $this->apiVersion, 'timestamp' => date('Y-m-d H:i:s'), 'biz_content' => '{"mediaId":"' . $this->media_id . '"}', 'charset' => $this->charset); $spd18808 = $this->buildGetUrl($spdbffc2); $sp884794 = $spd18808; $spde874d = curl_init(); curl_setopt($spde874d, CURLOPT_URL, $this->serverUrl); curl_setopt($spde874d, CURLOPT_HEADER, TRUE); curl_setopt($spde874d, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spde874d, CURLOPT_TIMEOUT, $this->timeout); if ($this->METHOD_POST == 'POST') { curl_setopt($spde874d, CURLOPT_POST, 1); curl_setopt($spde874d, CURLOPT_POSTFIELDS, $sp884794); } $spfe083a = curl_exec($spde874d); $sp832ee7 = curl_getinfo($spde874d, CURLINFO_HTTP_CODE); curl_close($spde874d); echo $spfe083a; $spdbffc2 = explode('

', $spfe083a, 2); $sp59c615 = $spdbffc2[0]; if ($sp832ee7 == '200') { $speb838e = $spdbffc2[1]; } else { $speb838e = ''; } return $this->execute($sp59c615, $speb838e, $sp832ee7); } public function execute($sp59c615 = '', $speb838e = '', $sp832ee7 = '') { $sp9ea971 = new AlipayMobilePublicMultiMediaExecute($sp59c615, $speb838e, $sp832ee7); return $sp9ea971; } public function buildGetUrl($sp3f78ce = array()) { if (!is_array($sp3f78ce)) { } $sp1835de = $this->buildQuery($sp3f78ce); $sp1cbb2b = ''; $spfd73a0 = 64; $spa49249 = $this->privateKey; $spe602aa = array(); if (!stripos($spa49249, '
')) { $sp1b7341 = 0; while ($spd10262 = substr($spa49249, $sp1b7341 * $spfd73a0, $spfd73a0)) { $spe602aa[] = $spd10262; $sp1b7341++; } } else { } $spa49249 = '-----BEGIN RSA PRIVATE KEY-----
' . implode('
', $spe602aa); $spa49249 = $spa49249 . '
-----END RSA PRIVATE KEY-----'; $sp685fe9 = openssl_pkey_get_private($spa49249, $sp1cbb2b); $spb0879e = ''; if ('RSA2' == $this->sign_type) { openssl_sign($sp1835de, $spb0879e, $sp685fe9, OPENSSL_ALGO_SHA256); } else { openssl_sign($sp1835de, $spb0879e, $sp685fe9, OPENSSL_ALGO_SHA1); } openssl_free_key($sp685fe9); $spb0879e = base64_encode($spb0879e); $spb0879e = urlencode($spb0879e); $spd8d021 = $sp1835de . '&' . $this->SIGN . '=' . $spb0879e; return $spd8d021; } public function buildQuery($sp3f78ce) { if (!$sp3f78ce) { return null; } ksort($sp3f78ce); $spb9d69c = array(); foreach ($sp3f78ce as $sp9684a3 => $spb66e06) { $spb9d69c[] = $sp9684a3 . '=' . $spb66e06; } $sp1835de = implode('&', $spb9d69c); return $sp1835de; } }