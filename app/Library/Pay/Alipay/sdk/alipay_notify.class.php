<?php
require_once 'alipay_core.function.php'; class AlipayNotify { var $https_verify_url = 'https://mapi.alipay.com/gateway.do?service=notify_verify&'; var $http_verify_url = 'http://notify.alipay.com/trade/notify_query.do?'; var $alipay_config; function __construct($sp60f8fc) { $this->alipay_config = $sp60f8fc; } function AlipayNotify($sp60f8fc) { $this->__construct($sp60f8fc); } function verifyNotify() { if (empty($_POST)) { return false; } else { $spe3faec = $this->getSignVeryfy($_POST, $_POST['sign']); $sp071828 = 'false'; if (!empty($_POST['notify_id'])) { $sp071828 = $this->getResponse($_POST['notify_id']); } if (preg_match('/true$/i', $sp071828) && $spe3faec) { return true; } else { return false; } } } function verifyReturn() { if (empty($_GET)) { return false; } else { $spe3faec = $this->getSignVeryfy($_GET, $_GET['sign']); $sp071828 = 'false'; if (!empty($_GET['notify_id'])) { $sp071828 = $this->getResponse($_GET['notify_id']); } if (preg_match('/true$/i', $sp071828) && $spe3faec) { return true; } else { return false; } } } function getSignVeryfy($spb273dd, $sp9c9a88) { $sp8a8731 = paraFilter($spb273dd); $sp44dd2e = argSort($sp8a8731); $sp1f20d7 = createLinkString($sp44dd2e); switch (strtoupper(trim($this->alipay_config['sign_type']))) { case 'MD5': $sp6f89c8 = md5Verify($sp1f20d7, $sp9c9a88, $this->alipay_config['key']); break; default: $sp6f89c8 = false; } return $sp6f89c8; } function getResponse($sp5afa08) { $sp773afc = strtolower(trim($this->alipay_config['transport'])); $spbafcd9 = trim($this->alipay_config['partner']); if ($sp773afc == 'https') { $spa3e35d = $this->https_verify_url; } else { $spa3e35d = $this->http_verify_url; } $spa3e35d = $spa3e35d . 'partner=' . $spbafcd9 . '&notify_id=' . $sp5afa08; $sp071828 = getHttpResponseGET($spa3e35d, $this->alipay_config['cacert']); return $sp071828; } }