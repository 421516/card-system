<?php
require_once 'alipay_core.function.php'; require_once 'alipay_md5.function.php'; class AlipayNotify { var $https_verify_url = 'https://mapi.alipay.com/gateway.do?service=notify_verify&'; var $http_verify_url = 'http://notify.alipay.com/trade/notify_query.do?'; var $alipay_config; function __construct($sp751298) { $this->alipay_config = $sp751298; } function AlipayNotify($sp751298) { $this->__construct($sp751298); } function verifyNotify() { if (empty($_POST)) { return false; } else { $sp93307f = $this->getSignVeryfy($_POST, $_POST['sign']); $spa8c67c = 'false'; if (!empty($_POST['notify_id'])) { $spa8c67c = $this->getResponse($_POST['notify_id']); } if (preg_match('/true$/i', $spa8c67c) && $sp93307f) { return true; } else { return false; } } } function verifyReturn() { if (empty($_GET)) { return false; } else { $sp93307f = $this->getSignVeryfy($_GET, $_GET['sign']); $spa8c67c = 'false'; if (!empty($_GET['notify_id'])) { $spa8c67c = $this->getResponse($_GET['notify_id']); } if (preg_match('/true$/i', $spa8c67c) && $sp93307f) { return true; } else { return false; } } } function getSignVeryfy($sp570e90, $sp885ea3) { $spa5ff74 = paraFilter($sp570e90); $spb0677b = argSort($spa5ff74); $sp313d7f = createLinkString($spb0677b); $sp3f21d5 = false; switch (strtoupper(trim($this->alipay_config['sign_type']))) { case 'MD5': $sp3f21d5 = md5Verify($sp313d7f, $sp885ea3, $this->alipay_config['key']); break; default: $sp3f21d5 = false; } return $sp3f21d5; } function getResponse($sp9381d6) { $sp1c94e5 = strtolower(trim($this->alipay_config['transport'])); $spd4b8de = trim($this->alipay_config['partner']); $spfa6040 = ''; if ($sp1c94e5 == 'https') { $spfa6040 = $this->https_verify_url; } else { $spfa6040 = $this->http_verify_url; } $spfa6040 = $spfa6040 . 'partner=' . $spd4b8de . '&notify_id=' . $sp9381d6; $spa8c67c = getHttpResponseGET($spfa6040, $this->alipay_config['cacert']); return $spa8c67c; } }