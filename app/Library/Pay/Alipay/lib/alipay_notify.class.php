<?php
require_once 'alipay_core.function.php'; require_once 'alipay_md5.function.php'; class AlipayNotify { var $https_verify_url = 'https://mapi.alipay.com/gateway.do?service=notify_verify&'; var $http_verify_url = 'http://notify.alipay.com/trade/notify_query.do?'; var $alipay_config; function __construct($spe325b5) { $this->alipay_config = $spe325b5; } function AlipayNotify($spe325b5) { $this->__construct($spe325b5); } function verifyNotify() { if (empty($_POST)) { return false; } else { $sp3b4a88 = $this->getSignVeryfy($_POST, $_POST['sign']); $spcf074b = 'false'; if (!empty($_POST['notify_id'])) { $spcf074b = $this->getResponse($_POST['notify_id']); } if (preg_match('/true$/i', $spcf074b) && $sp3b4a88) { return true; } else { return false; } } } function verifyReturn() { if (empty($_GET)) { return false; } else { $sp3b4a88 = $this->getSignVeryfy($_GET, $_GET['sign']); $spcf074b = 'false'; if (!empty($_GET['notify_id'])) { $spcf074b = $this->getResponse($_GET['notify_id']); } if (preg_match('/true$/i', $spcf074b) && $sp3b4a88) { return true; } else { return false; } } } function getSignVeryfy($sp159e40, $sp23eef6) { $sp4bb27a = paraFilter($sp159e40); $sp473cc2 = argSort($sp4bb27a); $sp8338f0 = createLinkString($sp473cc2); $sp7713cf = false; switch (strtoupper(trim($this->alipay_config['sign_type']))) { case 'MD5': $sp7713cf = md5Verify($sp8338f0, $sp23eef6, $this->alipay_config['key']); break; default: $sp7713cf = false; } return $sp7713cf; } function getResponse($sp9e4b4c) { $spe4851f = strtolower(trim($this->alipay_config['transport'])); $spac6922 = trim($this->alipay_config['partner']); $sp0c793d = ''; if ($spe4851f == 'https') { $sp0c793d = $this->https_verify_url; } else { $sp0c793d = $this->http_verify_url; } $sp0c793d = $sp0c793d . 'partner=' . $spac6922 . '&notify_id=' . $sp9e4b4c; $spcf074b = getHttpResponseGET($sp0c793d, $this->alipay_config['cacert']); return $spcf074b; } }