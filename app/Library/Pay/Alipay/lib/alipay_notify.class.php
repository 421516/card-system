<?php
require_once 'alipay_core.function.php'; require_once 'alipay_md5.function.php'; class AlipayNotify { var $https_verify_url = 'https://mapi.alipay.com/gateway.do?service=notify_verify&'; var $http_verify_url = 'http://notify.alipay.com/trade/notify_query.do?'; var $alipay_config; function __construct($sp233f0d) { $this->alipay_config = $sp233f0d; } function AlipayNotify($sp233f0d) { $this->__construct($sp233f0d); } function verifyNotify() { if (empty($_POST)) { return false; } else { $spb12925 = $this->getSignVeryfy($_POST, $_POST['sign']); $spb1e474 = 'false'; if (!empty($_POST['notify_id'])) { $spb1e474 = $this->getResponse($_POST['notify_id']); } if (preg_match('/true$/i', $spb1e474) && $spb12925) { return true; } else { return false; } } } function verifyReturn() { if (empty($_GET)) { return false; } else { $spb12925 = $this->getSignVeryfy($_GET, $_GET['sign']); $spb1e474 = 'false'; if (!empty($_GET['notify_id'])) { $spb1e474 = $this->getResponse($_GET['notify_id']); } if (preg_match('/true$/i', $spb1e474) && $spb12925) { return true; } else { return false; } } } function getSignVeryfy($sp1a550c, $sp26d1d6) { $sp231fce = paraFilter($sp1a550c); $sp0411d0 = argSort($sp231fce); $spb88d44 = createLinkString($sp0411d0); $spdf6b0e = false; switch (strtoupper(trim($this->alipay_config['sign_type']))) { case 'MD5': $spdf6b0e = md5Verify($spb88d44, $sp26d1d6, $this->alipay_config['key']); break; default: $spdf6b0e = false; } return $spdf6b0e; } function getResponse($sp31bb17) { $sp9a1036 = strtolower(trim($this->alipay_config['transport'])); $sp2a947c = trim($this->alipay_config['partner']); $spa32c48 = ''; if ($sp9a1036 == 'https') { $spa32c48 = $this->https_verify_url; } else { $spa32c48 = $this->http_verify_url; } $spa32c48 = $spa32c48 . 'partner=' . $sp2a947c . '&notify_id=' . $sp31bb17; $spb1e474 = getHttpResponseGET($spa32c48, $this->alipay_config['cacert']); return $spb1e474; } }