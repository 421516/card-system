<?php
require_once 'alipay_core.function.php'; require_once 'alipay_md5.function.php'; class AlipaySubmit { var $alipay_config; var $alipay_gateway_new = 'https://mapi.alipay.com/gateway.do?'; function __construct($sp751298) { $this->alipay_config = $sp751298; } function AlipaySubmit($sp751298) { $this->__construct($sp751298); } function buildRequestMysign($spb0677b) { $sp313d7f = createLinkString($spb0677b); switch (strtoupper(trim($this->alipay_config['sign_type']))) { case 'MD5': $sp8cd832 = md5Sign($sp313d7f, $this->alipay_config['key']); break; default: $sp8cd832 = ''; } return $sp8cd832; } function buildRequestPara($sp570e90) { $spa5ff74 = paraFilter($sp570e90); $spb0677b = argSort($spa5ff74); $sp8cd832 = $this->buildRequestMysign($spb0677b); $spb0677b['sign'] = $sp8cd832; $spb0677b['sign_type'] = strtoupper(trim($this->alipay_config['sign_type'])); return $spb0677b; } function buildRequestParaToString($sp570e90) { $sp40c6d7 = $this->buildRequestPara($sp570e90); $sp2e7a78 = createLinkStringUrlEncode($sp40c6d7); return $sp2e7a78; } function buildRequestForm($sp570e90, $sp1ebc2f, $speb9d82) { $sp40c6d7 = $this->buildRequestPara($sp570e90); $sp567372 = '<form id=\'alipaysubmit\' name=\'alipaysubmit\' action=\'' . $this->alipay_gateway_new . '_input_charset=' . trim(strtolower($this->alipay_config['input_charset'])) . '\' method=\'' . $sp1ebc2f . '\'>'; foreach ($sp40c6d7 as $spa8a71b => $sp3172ba) { $sp567372 .= '<input type=\'hidden\' name=\'' . $spa8a71b . '\' value=\'' . $sp3172ba . '\'/>'; } $sp567372 = $sp567372 . '<input type=\'submit\'  value=\'' . $speb9d82 . '\' style=\'display:none;\'></form>'; $sp567372 = $sp567372 . '<script>document.forms[\'alipaysubmit\'].submit();</script>'; return $sp567372; } function query_timestamp() { $sp7a0d0d = $this->alipay_gateway_new . 'service=query_timestamp&partner=' . trim(strtolower($this->alipay_config['partner'])) . '&_input_charset=' . trim(strtolower($this->alipay_config['input_charset'])); $spb76e17 = ''; $sp79baa1 = new DOMDocument(); $sp79baa1->load($sp7a0d0d); $spe757d1 = $sp79baa1->getElementsByTagName('encrypt_key'); $spb76e17 = $spe757d1->item(0)->nodeValue; return $spb76e17; } }