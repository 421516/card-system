<?php
namespace App\Console; use App\Library\WeChatMessage; use App\System; use Carbon\Carbon; use Illuminate\Console\Scheduling\Schedule; use Illuminate\Foundation\Console\Kernel as ConsoleKernel; use Illuminate\Support\Facades\DB; use Illuminate\Support\Facades\Log; class Kernel extends ConsoleKernel { protected $commands = array(); protected function schedule(Schedule $spb23f74) { try { \DB::connection()->getPdo(); if (\DB::table('migrations')->count() === 0) { throw new \Exception('No migration table'); } if (!\Schema::hasTable('systems')) { throw new \Exception('No system table'); } } catch (\Exception $sp2a4a9a) { if (config('database.connections.mysql.host') === '数据库地址') { echo ' * Please config your database info in \'.env\' 
'; } else { echo ' * Database connection error: ' . $sp2a4a9a->getMessage() . '
'; } return; } if (System::_getInt('order_clean_unpay_open') === 1) { $sp4cd8b1 = System::_getInt('order_clean_unpay_day', 7); $spb23f74->call(function () use($sp4cd8b1) { \App\Order::where('status', \App\Order::STATUS_UNPAY)->where('created_at', '<', (new Carbon())->addDays(-$sp4cd8b1))->delete(); })->dailyAt('01:00'); } } protected function commands() { $this->load(__DIR__ . '/Commands'); require base_path('routes/console.php'); } }